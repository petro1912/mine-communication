var ChatBeacon,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(a,r,o,u){return new(o||(o=Promise))(function(e,t){function i(e){try{s(u.next(e))}catch(e){t(e)}}function n(e){try{s(u.throw(e))}catch(e){t(e)}}function s(t){t.done?e(t.value):new o(function(e){e(t.value)}).then(i,n)}s((u=u.apply(a,r||[])).next())})},__generator=this&&this.__generator||function(i,n){var s,a,r,e,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(r=a[2&t[0]?"return":t[0]?"throw":"next"])&&!(r=r.call(a,t[1])).done)return r;switch(a=0,r&&(t=[0,r.value]),t[0]){case 0:case 1:r=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,a=t[1],t=[0];continue;case 7:t=o.ops.pop(),o.trys.pop();continue;default:if(!(r=0<(r=o.trys).length&&r[r.length-1])&&(6===t[0]||2===t[0])){o=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){o.label=t[1];break}if(6===t[0]&&o.label<r[1]){o.label=r[1],r=t;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(t);break}r[2]&&o.ops.pop(),o.trys.pop();continue}t=n.call(i,o)}catch(e){t=[6,e],a=0}finally{s=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(e){var c,t;c=e.Utility||(e.Utility={}),t=function(){function e(){}return e.prototype.serializeToQueryString=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},e.prototype.requestX=function(t,a,r,o){var u=this;return new Promise(function(i,n){var e=null;null!=r&&(a!==c.getVerb?e=JSON.stringify(r):(t+="?"+u.serializeToQueryString(r),r=null));var s=new XMLHttpRequest;"withCredentials"in s||(s=new window.XDomainRequest),-1<t.indexOf("?")?t+="&r="+(new Date).valueOf():t+="?r="+(new Date).valueOf(),s.open(a,t),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),null!=o&&o.forEach(function(e,t){s.setRequestHeader(t,e)}),s.onload=function(e){if(200<=s.status&&s.status<300){var t=JSON.parse(s.responseText);i(t)}else n({status:s.status,statusText:s.statusText})},s.onerror=function(){n({status:s.status,statusText:s.statusText})},s.send(e)})},e}(),c.ApiClientBase=t}(ChatBeacon||(ChatBeacon={})),function(e){var t,i;t=e.Application||(e.Application={}),(i=t.AppContext||(t.AppContext={}))[i.Site=0]="Site",i[i.Iframe=1]="Iframe",i[i.Popout=2]="Popout"}(ChatBeacon||(ChatBeacon={})),function(l){!function(e){e.staticUrl=null,e.serviceUrl=null,e.storageKey="beacon",e.emptyGuid="00000000-0000-0000-0000-000000000000",e.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.minDateTime=new Date(1970,1),e.eventShowChatWindow="beacon.showChatWindows",e.eventChatStateChanged="beacon.chatstatechanged",e.eventInviteData="beacon.newInvitedata",e.eventQueueChanged="beacon.queueStatusChanged",e.eventSurveyRendered="beacon.surveyRendered",e.eventSurveyItemMissing="beacon.surveyItemMissing",e.eventSegmentRendered="beacon.segmentRendered",e.eventSegmentsProcessed="beacon.segmentsProcessed",e.eventFileUploadProgressed="beacon.fileUploadProgressed",e.eventSurveySubmitted="beacon.surveySubmitted",e.eventSessionBanned="beacon.sessionbanned",e.eventChatPolled="beacon.chatpolled",e.eventAlterCss="beacon.alterCss",e.eventSegmentSent="beacon.segmentSent",e.eventOnSubmitSurvey="beacon.onSubmitSurvey",e.eventOnEndRequest="beacon.onEndRequest",e.eventOnEndChat="beacon.onEndChat",e.eventOnPrintChat="beacon.onPrintChat",e.eventOnEmailChat="beacon.onEmailChat",e.eventOnSendSegment="beacon.onSendSegment",e.eventOnOpenWnd="beacon.onOpenWnd",e.eventOnModuleInit="beacon.onModuleInit",e.eventOnParentResize="beacon.onParentResize",e.eventOnSessionRestart="beacon.onSessionRestart",e.eventOnGdprUpdate="beacon.onGdprUpdate",e.eventOnOpTypingChange="beacon.onOpTypingChange",e.eventOnFileEnableChange="beacon.onFileEnableChange",e.eventOnInputFocus="beacon.onInputFocus",e.SESSIONID_CONST="SightMaxSessionId",e.VISITORID_CONST="SightMaxVisitorId",e.QUEUE_CONST="chatbeacon_queue",e.scriptName="chatbeacon.js",e.wndScriptName="chatwindow.js",e.attrRoleBtn='data-beacon-role="button"',e.attrRoleInvite='data-beacon-role="invite"',e.attrRoleSegmentsEl='data-beacon-role="segments"',e.attrChatState='data-beacon-state="chat"',e.attrQueueState='data-beacon-state="queue"',e.attrOptions="data-beacon-options",e.attrActionLink='data-beacon-action="link"',e.attrTheme="data-beacon-theme",e.attrAction="data-beacon-action",e.attrRole="data-beacon-role",e.attrRoleChat='data-beacon-role="chat"',e.attrRoleSegment='data-beacon-role="segment"',e.postVerb="post",e.getVerb="get",e.putVerb="put",e.deleteVerb="delete";var t=function(){function e(){}return e.encode=function(e){if("function"==typeof btoa)return btoa(e);var t,i,n,s,a,r,o,u="",c=0;for(e=this.utf8Encode(e);c<e.length;)s=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(i=e.charCodeAt(c++))>>4,r=(15&i)<<2|(n=e.charCodeAt(c++))>>6,o=63&n,isNaN(i)?r=o=64:isNaN(n)&&(o=64),u=u+l.Utility.keyStr.charAt(s)+l.Utility.keyStr.charAt(a)+l.Utility.keyStr.charAt(r)+l.Utility.keyStr.charAt(o);return u},e.utf8Encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):(127<n&&n<2048?t+=String.fromCharCode(n>>6|192):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128)),t+=String.fromCharCode(63&n|128))}return t},e.decode=function(e){if("function"==typeof atob)return atob(e);for(var t,i={},n=0,s=0,a="",r=String.fromCharCode,o=e.length,u=l.Utility.keyStr,c=0;c<64;c++)i[u.charAt(c)]=c;for(var p=0;p<o;p++)for(n=(n<<6)+i[e.charAt(p)],s+=6;8<=s;)((t=n>>>(s-=8)&255)||p<o-2)&&(a+=r(t));return a},e.parseIso8601=function(e){var t,i=new Date(NaN),n=/^\s*(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d).*Z\s*$/.exec(e);return n&&(t=+n[2],i.setUTCFullYear(parseInt(n[1]),t-1,parseInt(n[3])),i.setUTCHours(parseInt(n[4])),i.setUTCMinutes(parseInt(n[5])),i.setUTCSeconds(parseInt(n[6])),t!==i.getUTCMonth()+1&&i.setTime(NaN)),i},e}();e.Util=t}(l.Utility||(l.Utility={}))}(ChatBeacon||(ChatBeacon={})),Element.prototype.removeMe=function(){return this.hasOwnProperty("remove")?this.remove():null!=this.parentElement&&this.parentElement.removeChild(this),this},HTMLElement.prototype.addClass=function(e){for(var t=e.split(" "),i=0;i<t.length;i++){var n=t[i];this.classList?this.classList.add(n):this.className.indexOf(n)<0&&(this.className+=" "+n)}return this},HTMLElement.prototype.removeClass=function(e){for(var t=e.split(" "),i=0;i<t.length;i++){var n=t[i];this.classList?this.classList.remove(n):-1<this.className.indexOf(n)&&(this.className=this.className.replace(" "+n,""))}return this},HTMLElement.prototype.removeClassesContaining=function(e){var t=new Array;if(this.classList){for(var i=0;i<this.classList.length;i++){-1<(s=this.classList.item(i)).indexOf(e)&&t.push(s)}for(var n=0;n<t.length;n++){var s=t[n];this.removeClass(s)}}else{for(var a=this.className.split(" "),r=0;r<a.length;r++){-1<(s=a[r]).indexOf(e)&&t.push(s)}for(var o=0;o<t.length;o++){s=t[o];this.removeClass(s)}}return this},HTMLElement.prototype.hasClass=function(e){for(var t=e.split(","),i=0;i<t.length;i++){var n=t[i].trim();if(this.classList){if(this.classList.contains(n))return!0}else if(-1<this.className.indexOf(n))return!0}return!1},HTMLElement.prototype.isChildOfAttr=function(e,t){for(var i=this.parentElement;i;){if(i.hasAttribute(e)){if(null==t)return!0;if(t==i.getAttribute(e))return!0}i=i.parentElement}return!1},HTMLElement.prototype.isChildOfCss=function(e){for(var t=this.parentElement;t;){if(t.hasClass(e))return!0;t=t.parentElement}return!1},Element.prototype.appendText=function(e){return this.insertAdjacentText("beforeend",e),this},NodeList.prototype.addClass=function(e){for(var t=e.split(" "),i=0;i<this.length;i++){var n=this[i];if(n.addClass)for(var s=0;s<t.length;s++){var a=t[s];n.addClass(a)}}return this},NodeList.prototype.removeClass=function(e){for(var t=e.split(" "),i=0;i<this.length;i++){var n=this[i];if(n.removeClass)for(var s=0;s<t.length;s++){var a=t[s];n.removeClass(a)}}return this},NodeList.prototype.removeClassesContaining=function(e){for(var t=0;t<this.length;t++){var i=this[t];i.removeClassesContaining&&i.removeClassesContaining(e)}return this},NodeList.prototype.hasClass=function(e){for(var t=e.split(" "),i=!1,n=0;n<this.length;n++){var s=this[n];if(s.hasClass)for(var a=0;a<t.length;a++)s.classList?i||(i=s.classList.contains(e)):i||(i=-1<s.className.indexOf(e))}return i},NodeList.prototype.appendText=function(e){for(var t=0;t<this.length;t++){var i=this[t];i.appendText&&i.appendText(e)}return this},NodeList.prototype.getAttrVal=function(e){for(var t=0;t<this.length;t++){var i=this[t].getAttribute(e);if(i)return i}return""},NodeList.prototype.addEventListener=function(e,t,i){for(var n=0;n<this.length;n++){var s=this[n];s instanceof Element&&s.addEventListener(e,t,i)}return this},function(e){var t,i,n;t=e.ServerModels||(e.ServerModels={}),i=function(){},n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t.ChatBeaconNamedObj=i),t.ChatBeaconNameValueObj=n}(ChatBeacon||(ChatBeacon={})),function(e){var t,i;t=e.ServerModels||(e.ServerModels={}),function(e){var t;(t=e.ActionType||(e.ActionType={}))[t.InviteVisitor=0]="InviteVisitor",t[t.PushSession=1]="PushSession",t[t.SendTextInvite=2]="SendTextInvite",t[t.EndChat=3]="EndChat",t[t.SendEmail=4]="SendEmail",t[t.SendSegment=5]="SendSegment",t[t.BanVisitor=6]="BanVisitor",t[t.AlertOperator=7]="AlertOperator",t[t.TerminateAllActions=8]="TerminateAllActions",t[t.SendInlineInvite=9]="SendInlineInvite",t[t.StartChat=10]="StartChat",t[t.ExecuteScript=11]="ExecuteScript",t[t.TransferToOperator=12]="TransferToOperator",t[t.TransferToQueue=13]="TransferToQueue",t[t.SendJoinRequest=14]="SendJoinRequest",t[t.HideInvite=15]="HideInvite",t[t.HideWindow=16]="HideWindow",t[t.ShowMarquee=17]="ShowMarquee";var i=function(){};e.RuleAction=i}((i=t.Account||(t.Account={})).Rules||(i.Rules={}))}(ChatBeacon||(ChatBeacon={})),function(e){var s,t,i;s=e.ServerModels||(e.ServerModels={}),t=s.Account||(s.Account={}),function(e){var t;(t=e.QueueStatus||(e.QueueStatus={}))[t.Away=0]="Away",t[t.Online=1]="Online",t[t.BackIn5=2]="BackIn5",t[t.Lunch=3]="Lunch",t[t.Custom=4]="Custom";var i=function(){};e.FileSettings=i;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(s.ChatBeaconNamedObj);e.Queue=n}((i=t.Site||(t.Site={})).Queue||(i.Queue={}))}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),function(e){var i,t;(t=i=e.ItemType||(e.ItemType={}))[t.Label=0]="Label",t[t.Textbox=1]="Textbox",t[t.CheckBoxGroup=2]="CheckBoxGroup",t[t.Checkbox=3]="Checkbox",t[t.RadioGroup=4]="RadioGroup",t[t.RadioButton=5]="RadioButton",t[t.Email=6]="Email",t[t.Telephone=7]="Telephone",t[t.Number=8]="Number",t[t.DateTime=9]="DateTime",t[t.Password=10]="Password",t[t.Url=11]="Url",t[t.Name=12]="Name",t[t.Subitem=13]="Subitem";var n=function(){},s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.Item=n),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.ParentItem=s);e.ValueItem=a;var r=function(t){function e(){var e=t.call(this)||this;return e.type=i.Subitem,e}return __extends(e,t),e}(n);e.SubItem=r;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(s);e.GroupItem=o;var u=function(t){function e(){var e=t.call(this)||this;return e.type=i.Checkbox,e}return __extends(e,t),e}(a);e.Checkbox=u;var c=function(t){function e(){var e=t.call(this)||this;return e.type=i.CheckBoxGroup,e}return __extends(e,t),e}(o);e.CheckboxGroup=c;var p=function(t){function e(){var e=t.call(this)||this;return e.type=i.Email,e}return __extends(e,t),e}(a);e.Email=p;var l=function(t){function e(){var e=t.call(this)||this;return e.type=i.Label,e}return __extends(e,t),e}(s);e.Label=l;var h=function(t){function e(){var e=t.call(this)||this;return e.type=i.Name,e}return __extends(e,t),e}(a);e.Name=h;var d=function(t){function e(){var e=t.call(this)||this;return e.type=i.RadioButton,e}return __extends(e,t),e}(a);e.RadioButton=d;var v=function(t){function e(){var e=t.call(this)||this;return e.type=i.RadioGroup,e}return __extends(e,t),e}(o);e.RadioGroup=v;var g=function(i){function e(e){void 0===e&&(e=!1);var t=i.call(this)||this;return t.multiLine=e,t}return __extends(e,i),e}(a);e.Textbox=g}((s=n.Queue||(n.Queue={})).Survey||(s.Survey={}))}(ChatBeacon||(ChatBeacon={})),function(e){var n,t,i,s;n=e.ServerModels||(e.ServerModels={}),t=n.Account||(n.Account={}),i=t.Site||(t.Site={}),function(e){var t;(t=e.SurveyType||(e.SurveyType={}))[t.PreChat=1]="PreChat",t[t.PostChat=2]="PostChat",t[t.Offline=3]="Offline";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(n.ChatBeaconNamedObj);e.Survey=i}((s=i.Queue||(i.Queue={})).Survey||(s.Survey={}))}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s,a,r;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=n.Queue||(n.Queue={}),a=s.Chat||(s.Chat={}),r=function(){},(a.Segment||(a.Segment={})).PushUrl=r}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s,a;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=n.Queue||(n.Queue={}),function(e){var t,i;(t=e.SegmentType||(e.SegmentType={}))[t.Operator=0]="Operator",t[t.System=1]="System",t[t.Visitor=2]="Visitor",t[t.VisitorPreview=3]="VisitorPreview",(i=e.Action||(e.Action={}))[i.AcceptChat=2]="AcceptChat",i[i.JoinChat=3]="JoinChat",i[i.OperatorLeftChat=5]="OperatorLeftChat",i[i.TransferRequest=7]="TransferRequest",i[i.TransferAccept=8]="TransferAccept",i[i.TransferReject=9]="TransferReject",i[i.Nag=16]="Nag",i[i.JoinChatAsCoach=17]="JoinChatAsCoach",i[i.TransferRequestWithdraw=18]="TransferRequestWithdraw",i[i.VisitorEndedChat=24]="VisitorEndedChat",i[i.OperatorEndedChat=25]="OperatorEndedChat",i[i.SystemTimedOutChat=26]="SystemTimedOutChat",i[i.QueueTransfer=27]="QueueTransfer",i[i.TranslationEnabled=28]="TranslationEnabled",i[i.TranslationDisabled=29]="TranslationDisabled",i[i.TranslationDisabledOptional=30]="TranslationDisabledOptional",i[i.VisitorSegmentPreview=31]="VisitorSegmentPreview",i[i.ChatLocked=32]="ChatLocked",i[i.ChatUnlocked=33]="ChatUnlocked",i[i.FileUploadBegan=36]="FileUploadBegan",i[i.FileUploadCanceled=37]="FileUploadCanceled",i[i.FileTransferEnabled=38]="FileTransferEnabled",i[i.FileTransferDisabled=39]="FileTransferDisabled",i[i.None=0]="None";var n=function(){};e.Segment=n}((a=s.Chat||(s.Chat={})).Segment||(a.Segment={}))}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s,a,r,o;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=n.Queue||(n.Queue={}),a=s.Chat||(s.Chat={}),r=a.Segment||(a.Segment={}),o=function(t){function e(){var e=t.call(this)||this;return e.type=r.SegmentType.System,e}return __extends(e,t),e}(r.Segment),r.SytemSegment=o}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s,a,r;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=n.Queue||(n.Queue={}),a=s.Chat||(s.Chat={}),r=function(){},(a.Segment||(a.Segment={})).Translation=r}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s,a,r,o,u;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=n.Queue||(n.Queue={}),a=s.Chat||(s.Chat={}),r=a.Segment||(a.Segment={}),o=r.Visitor||(r.Visitor={}),u=function(t){function e(){var e=t.call(this)||this;return e.type=r.SegmentType.Visitor,e}return __extends(e,t),e}(r.Segment),o.VisitorSegment=u}(ChatBeacon||(ChatBeacon={})),function(e){var r,t,i,o;r=e.ServerModels||(e.ServerModels={}),t=r.Account||(r.Account={}),i=t.Site||(t.Site={}),function(i){var n,e,t;(e=n=i.Status||(i.Status={}))[e.None=0]="None",e[e.Requested=1]="Requested",e[e.Active=2]="Active",e[e.Transfer=3]="Transfer",e[e.Locked=4]="Locked",e[e.RequestCanceled=5]="RequestCanceled",e[e.Ended=6]="Ended",(t=i.ChatType||(i.ChatType={}))[t.Noop=0]="Noop",t[t.VisitorInitiated=1]="VisitorInitiated",t[t.OperatorInvited=2]="OperatorInvited",t[t.OperatorForced=3]="OperatorForced",t[t.ServerForced=4]="ServerForced",t[t.Sms=5]="Sms",t[t.Facebook=6]="Facebook",t[t.App=7]="App";var s=function(t){function e(){var e=t.call(this)||this;return e.status=n.None,e.queue=new o.Queue,e.queue.status=o.QueueStatus.Away,e.queue.id=0,e.id=0,e.translating=!1,e.participants=new i.ParticpantList,e}return __extends(e,t),e}(r.ChatBeaconNamedObj);i.Chat=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(r.ChatBeaconNamedObj);i.ChatSurvey=a}((o=i.Queue||(i.Queue={})).Chat||(o.Chat={}))}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),function(e){var t;(t=e.OperatorStatus||(e.OperatorStatus={}))[t.Online=0]="Online",t[t.BackIn5=1]="BackIn5",t[t.OutForLunch=2]="OutForLunch",t[t.Away=3]="Away",t[t.Offline=4]="Offline",t[t.Custom=5]="Custom";var i=function(){};e.Participant=i;var n=function(){this.current=new Array};e.ParticpantList=n}((s=n.Queue||(n.Queue={})).Chat||(s.Chat={}))}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s,a,r;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=n.Queue||(n.Queue={}),a=s.Chat||(s.Chat={}),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t.ChatBeaconNamedObj),a.Request=r}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=function(){},(i.Site||(i.Site={})).Page=n}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=function(){},(i.Site||(i.Site={})).Site=n}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t.ChatBeaconNameValueObj),n.Variable=s}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=function(){},(i.Visitor||(i.Visitor={})).Visitor=n}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=function(){},(i.Visitor||(i.Visitor={})).VisitorProfile=n}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),function(e){var t,i;(t=e.InviteStatus||(e.InviteStatus={}))[t.Invited=0]="Invited",t[t.Accepted=1]="Accepted",t[t.Declined=2]="Declined",(i=e.InviteType||(e.InviteType={}))[i.Default=0]="Default",i[i.Text=1]="Text",i[i.Custom=2]="Custom";var n=function(){function e(){}return Object.defineProperty(e.prototype,"sentDate",{get:function(){return null==this._sentDate&&(this._sentDate=new Date(this.sent)),this._sentDate},enumerable:!0,configurable:!0}),e}();e.Invite=n}((n=i.Site||(i.Site={})).Session||(n.Session={}))}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=function(){this.visitor=new i.Visitor.Visitor},(n.Session||(n.Session={})).Session=s}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n,s;t=e.ServerModels||(e.ServerModels={}),i=t.Account||(t.Account={}),n=i.Site||(i.Site={}),s=function(){},(n.Session||(n.Session={})).SessionSync=s}(ChatBeacon||(ChatBeacon={})),function(e){var t,i;t=e.Models||(e.Models={}),i=function(){function e(){this.handlers=[]}return e.prototype.on=function(e){this.handlers.push(e)},e.prototype.off=function(t){this.handlers=this.handlers.filter(function(e){return e!==t})},e.prototype.trigger=function(t){this.handlers.slice(0).forEach(function(e){return e(t)})},e.prototype.expose=function(){return this},e}(),t.BeaconEvent=i}(ChatBeacon||(ChatBeacon={})),function(i){var e,t;e=i.Models||(i.Models={}),t=function(){function e(e,t){this.originHash=i.Utility.Util.encode(window.location.toString()+":"+window.location.origin),this.event=e,this.args=t}return e.currentOriginHash=function(){return i.Utility.Util.encode(window.location.toString()+":"+window.location.origin)},e}(),e.BeaconMsg=t}(ChatBeacon||(ChatBeacon={})),function(e){var t;t=function(){},(e.Models||(e.Models={})).Timer=t}(ChatBeacon||(ChatBeacon={})),function(e){var t,i,n;t=e.Models||(e.Models={}),i=t.Chat||(t.Chat={}),(n=i.WindowTypes||(i.WindowTypes={}))[n.Frame=0]="Frame",n[n.Popout=1]="Popout",n[n.Child=2]="Child"}(ChatBeacon||(ChatBeacon={})),function(f){var e,s,r,y,b,i,a,m,t;e=f.Chat||(f.Chat={}),s=f.ServerModels.Account.Site.Queue.Survey.Survey,r=f.ServerModels.Account.Site.Queue.Survey.SurveyType,y=f.ServerModels.Account.Site.Queue.Chat.Chat,b=f.ServerModels.Account.Site.Queue.Chat.Status,i=f.ServerModels.Account.Site.Queue.QueueStatus,a=f.ServerModels.Account.Site.Queue.Chat.ChatType,m=f.Application.AppContext,t=function(){function e(){this.pollComplete=!0,this.site={id:0,name:null,gdprEnabled:null},this.visitorLang=null,this.pollEnabled=!1,this.lastSegId=0,this.fileUploadComplete=!0,this.fileUploadCanceled=!1,this.segmentsInitialized=!1,this.waitTimeUpdated=!1,this.lastScrollPos=0,this.options={},this.xStart=0,this.yStart=0,this.defaultQueueId=0,this.defaultSiteId=0,this.pollId=-1,this.lastYPos=0,this._banned=!1,this._opTyping=!1,this._fileEnabled=!1,this.chat=new y}return e.prototype.isActive=function(){return this.chat.status===b.Active||this.chat.status===b.Locked||this.chat.status===b.Transfer},e.prototype.isRequesting=function(){return this.chat.status===b.Requested},e.prototype.updateFrame=function(e,t,i){var n=this.getChatCtrl(),s=n.querySelector("iframe"),a=this.app.getAdditionalParmeters("child",i);a.skipprechat=1==e,a.skippostchat=1==t,a.visitorid=this.app.session.visitor.id,a.sessionid=this.app.session.id,a.c=1,i&&(a.theme=i),s.contentWindow.location.replace(this.app.getWindowUrl(n,a))},e.prototype.getChatCtrl=function(){return this.app.bQuery("[data-beacon-role='chat']")},e.prototype.getEventCache=function(){var e=this.app.getWndEvent();return e||this.app.eventArgsChatWindow(!1,!1)},e.prototype.setEventCache=function(e){this.app.setWndEvent(e)},e.prototype.init=function(g){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a,r,o,u,c,p,l,h,d,v=this;return __generator(this,function(e){switch(e.label){case 0:return this.app=document.beacon,this.stopPoll(),this.site.id=this.app.session.siteId,this._pollInterval=this.app.pollSlow,[4,this.app.ajax.getChat(null)];case 1:return t=e.sent(),i=t.chat,this.chat=null==i?new y:i,[4,this.app.ajax.getSite(this.site.id)];case 2:return n=e.sent(),this.site=n,this.defaultSiteId=this.app.queryStringPairs.siteid,null==i||i.status==b.None?(this.defaultQueueId=this.app.queryStringPairs.queueid,this.chat.queue.id=this.defaultQueueId):this.defaultQueueId=this.chat.queue.id,this.app.session.queueId=this.defaultQueueId,[4,this.app.ajax.getQueue(this.defaultQueueId)];case 3:return s=e.sent(),this.chat.queue=s,[4,this.app.ajax.getChatWnd(this.app.servicePath)];case 4:switch(a=e.sent(),this._pollInterval=this.app.pollSlow,0<(r=this.app.bQueryAll(".b-chat-win-loc")).length?r[0].insertAdjacentHTML("beforeend",a):document.body.insertAdjacentHTML("beforeend",a),(o=this.getChatCtrl()).addClass("b-modern"),this.app.queryStringPairs.popout&&o.addClass("b-popout"),this.app.isSecure&&o.addClass("b-secure"),u=o.getAttribute(f.Utility.attrOptions),c="popout",u?(this.options=JSON.parse(u),p=this.options.theme,c=this.options.type):(c=this.app.queryStringPairs.type,p=this.app.theme),-1<(l=p).toLowerCase().indexOf("blue")?l="blue":-1<p.toLowerCase().indexOf("slim")&&(l="slim"),o.addClass(l),null==c&&this.app.queryStringPairs.popout&&(c="popout"),c.toLowerCase()){case"frame":this.app.setAppContext(m.Site);break;case"child":this.app.setAppContext(m.Iframe);break;case"popout":this.app.setAppContext(m.Popout)}switch(this.app.AppCtx){case m.Popout:case m.Iframe:this._pollInterval=this.app.pollFast,this.lastSegId=0;break;case m.Site:this._pollInterval=this.app.pollMedium,this.updateFrame(this.app.queryStringPairs.skipprechat,this.app.queryStringPairs.skippostchat,this.options.theme)}return this.app.isMobileDevice()&&o.addClass("b-mobile"),g||this.wireUpAppEvents(),(h=this.getEventCache()).visible&&(d=new f.Models.BeaconMsg(f.Utility.eventShowChatWindow,this.app.eventArgsChatWindow(!0,h.byUser)),this.app.triggerEvent(d)),this.updateCtrlUiState(this.chat.status),this.startPoll(),this.app.moduleInitialized.on(function(e){"chat"==e.args.module&&e.args.type==m.Iframe&&v.app.AppCtx==m.Iframe&&v.app.postBrowserMSg(e)}),g||this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventOnModuleInit,{module:"chat",type:this.app.AppCtx,theme:p})),[2]}})})},e.prototype.updateChatStateCtrl=function(e,t){if(this.app.queryStringPairs.skipprechat&&t==b.None&&this.chat.queue.status==i.Online&&!e.hasClass("show-history")&&(t=f.ServerModels.Account.Site.Queue.Chat.Status.Requested),e.removeClassesContaining("b-chat-state-"),this.isActive()||0<this.app.chat.chat.priorChatId&&t==b.Requested)e.addClass("b-chat-state-active");else switch(t){case b.None:this.app.chat.chat.queue.status===i.Online?e.addClass("b-chat-state-prechat"):e.addClass("b-chat-state-offline");break;case b.Ended:e.addClass("b-chat-state-postchat");break;default:e.addClass("b-chat-state-"+b[t].toLowerCase())}},e.prototype.wireUpAppEvents=function(){var a=this;this.app.chatStateChanged.on(function(n){return __awaiter(a,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return n.originHash===f.Models.BeaconMsg.currentOriginHash()?[3,2]:((t=JSON.parse(JSON.stringify(this.chat))).status=n.args.newStatus,i={chat:t,request:null,gdprAccepted:!1},[4,this.processChatData(i)]);case 1:return e.sent(),[3,3];case 2:this.app.AppCtx!==m.Site&&this.app.postBrowserMSg(n),this.onChatStateChange(n.args),e.label=3;case 3:return[2]}})})}),this.app.queueStateChanged.on(function(t){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.chat.queue=t.args.queue,[4,this.onQueueStateChange()];case 1:return e.sent(),this.app.postBrowserMSg(t),this.app.postBrowserMSg(t),[2]}})})}),this.app.windowStateChanged.on(function(e){var t=a.app.eventArgsChatWindow(e.args.visible,e.args.byUser);a.setEventCache(t),e.args.visible?a.showChatCtrl():a.hideChatCtrl(),e.originHash==f.Models.BeaconMsg.currentOriginHash()&&(e.args.originalEvent=null,a.app.postBrowserMSg(e))}),this.app.inviteChanged.on(function(n){return __awaiter(a,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return n.args.accepted?this.app.AppCtx!=m.Site?[3,1]:(this.app.postBrowserMSg(n),t=this.app.eventArgsChatWindow(!0,!0),this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventShowChatWindow,t)),[3,3]):[3,3];case 1:return this.stopPoll(),(i=new s).skipped=!0,i.queueId=this.chat.queue.id,this.app.chat.chat.status===b.Ended?(i.type=r.PostChat,i.chatId=this.chat.id):i.type=r.PreChat,[4,this.submitSurvey(i)];case 2:e.sent(),this.startPoll(this.app.pollFast),e.label=3;case 3:return[2]}})})}),this.app.AppCtx!==m.Site?this.app.chatPolled.on(function(e){a.app.postBrowserMSg(e)}):(this.app.isMobileDevice()&&(window.addEventListener("scroll",function(e){a.getChatCtrl().hasClass("b-chat-ctrl-show")&&window.scrollTo(0,0)}),window.addEventListener("resize",function(){var e=new f.Models.BeaconMsg(f.Utility.eventOnParentResize,{height:window.innerHeight,width:window.innerWidth});a.app.postBrowserMSg(e)})),this.app.chatPolled.on(function(t){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t.originHash===f.Models.BeaconMsg.currentOriginHash()?[2]:[4,this.processChatData(t.args)];case 1:return e.sent(),[2]}})})})),this.app.endRequestRequest.on(function(t){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.stopPoll(),this.chat.status!=b.Requested?[3,3]:[4,this.cancelChatRequest(t)];case 1:return e.sent(),[4,this.getChatData()];case 2:e.sent(),this.app.postBrowserMSg(new f.Models.BeaconMsg(f.Utility.eventOnEndRequest,this.chat)),e.label=3;case 3:return this.startPoll(),[2]}})})}),this.app.endChatRequest.on(function(e){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.chat.status===b.Ended?[3,2]:(this.stopPoll(),[4,this.endChat()]);case 1:e.sent(),this.startPoll(),e.label=2;case 2:return[2]}})})}),this.app.sessionRestarted.on(function(e){a.app.postBrowserMSg(e)}),this.app.sessionBanned.on(function(e){a._banned=e.args.banned,e.args.banned?a.hideChatCtrl():a.showChatCtrl(),a.app.postBrowserMSg(e),a.handleBanning(e.args.banned)}),this.app.segmentRendered.on(function(e){var t=a.app.bQuery("["+f.Utility.attrRoleSegmentsEl+"]");if(null!=t&&1===t.childElementCount&&a.site.gdprEnabled&&null==a.chat.gdprAccepted){var i=a.chat.queue.gdpr,n=document.createElement("div");n.setAttribute("data-beacon-gdpr-container",""),n.innerHTML=i,t.appendChild(n);var s=a.app.bQuery("[data-beacon-gdpr]");null!=s&&s.addEventListener("change",function(){return __awaiter(a,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.app.ajax.updateGdpr(s.checked)];case 1:return e.sent(),t=new f.Models.BeaconMsg(f.Utility.eventOnGdprUpdate,{accepted:s.checked}),this.app.postBrowserMSg(t),n.addClass("checked"),setTimeout(function(){n.removeMe()},550),[2]}})})})}}),this.app.inputFocused.on(function(e){var t=a.app.bQuery("["+f.Utility.attrRoleChat+"]");a.app.AppCtx==m.Iframe&&a.app.postBrowserMSg(e),e.args.focused?t.addClass("focused"):t.removeClass("focused"),e.args.focused?a.app.bQuery("body").addClass("focused"):a.app.bQuery("body").removeClass("focused")})},e.prototype.ctrlIsVisible=function(){return this.getChatCtrl().hasClass("b-chat-ctrl-show")},e.prototype.showChatCtrl=function(){var e=this.getChatCtrl();e.hasClass("b-chat-ctrl-show")||this.app.AppCtx===m.Site&&(this.app.isMobileDevice()&&(this.lastYPos=window.scrollY,window.scrollTo(0,-1),document.body.addClass("locked")),e.removeClass("b-chat-ctrl-hide"),e.addClass("b-chat-ctrl-show"))},e.prototype.hideChatCtrl=function(){if(!this.getChatCtrl().hasClass("b-chat-ctrl-hide")&&this.app.AppCtx!=m.Iframe)if(this.app.AppCtx!==m.Popout){var e=this.getChatCtrl();e.removeClass("b-chat-ctrl-show"),e.addClass("b-chat-ctrl-hide"),document.body.removeClass("locked b-chat-ctrl-show"),this.app.AppCtx==m.Site&&(this.app.isMobileDevice()&&window.scrollTo(0,this.lastYPos),e.removeClass("b-chat-ctrl-show"),e.addClass("b-chat-ctrl-hide"))}else window.close()},e.prototype.onQueueStateChange=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a,r,o,u,c,p;return __generator(this,function(e){switch(e.label){case 0:for(i in t=this.app.bQueryAll("["+f.Utility.attrRoleChat+"][data-beacon-state~='queue'], ["+f.Utility.attrRoleChat+"] [data-beacon-state~='queue']"),f.ServerModels.Account.Site.Queue.QueueStatus)f.ServerModels.Account.Site.Queue.QueueStatus.hasOwnProperty(i)&&(n=parseInt(i),isNaN(n)||(s=f.ServerModels.Account.Site.Queue.QueueStatus[n],a="b-queue-state-"+s.toLowerCase(),t.removeClass(a),this.chat.queue.status==n&&t.addClass(a)));return r=this.app.bQueryAll("["+f.Utility.attrRoleChat+"] [data-beacon-role~='queueIcon']"),o=-1<r.getAttrVal("data-beacon-attr").indexOf("static"),0<r.length&&!o&&(u=this.app.ajax.getImgUrl(1,this.chat.queue.id)+"?r="+this.app.getUnique(),r[0].style.backgroundImage="url("+u+")"),this.app.bQueryAll("["+f.Utility.attrRoleChat+"] [data-beacon-name='queue']").appendText(this.chat.queue.name),c=this.app.bQueryAll("["+f.Utility.attrRoleChat+"].b-queue-state-text, ["+f.Utility.attrRoleChat+"] .b-queue-state-text"),this.chat.queue.status!=f.ServerModels.Account.Site.Queue.QueueStatus.Custom?[3,2]:[4,this.app.ajax.getQueue(this.chat.queue.id)];case 1:return p=e.sent(),c.appendText(p.message),[3,3];case 2:c.appendText(this.chat.queue.status.toString()),e.label=3;case 3:return[2]}})})},e.prototype.onChatStateChange=function(e){var t=e.newStatus;this.updateCtrlUiState(t)},e.prototype.updateCtrlUiState=function(t){var i=this,e=function(){var e=i.getEventCache();(!e.visible&&!e.byUser||i.chat.type!==a.Noop&&(i.isActive()||t===f.ServerModels.Account.Site.Queue.Chat.Status.Requested)||i.chat.type==a.OperatorForced)&&i.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventShowChatWindow,i.app.eventArgsChatWindow(!0,!1)))};switch(t){case f.ServerModels.Account.Site.Queue.Chat.Status.None:case f.ServerModels.Account.Site.Queue.Chat.Status.Ended:case f.ServerModels.Account.Site.Queue.Chat.Status.RequestCanceled:this.waitTimeUpdated=!1;break;case f.ServerModels.Account.Site.Queue.Chat.Status.Requested:e();break;case f.ServerModels.Account.Site.Queue.Chat.Status.Active:case f.ServerModels.Account.Site.Queue.Chat.Status.Transfer:case f.ServerModels.Account.Site.Queue.Chat.Status.Locked:e(),this.waitTimeUpdated=!1,this.lastSegId=0}this.isActive()||(this.visitorLang=null);var n=this.app.bQueryAll("["+f.Utility.attrRoleChat+"][data-beacon-state~='chat']");switch(this.updateChatStateCtrl(n,t),t){case f.ServerModels.Account.Site.Queue.Chat.Status.Transfer:case f.ServerModels.Account.Site.Queue.Chat.Status.Locked:case f.ServerModels.Account.Site.Queue.Chat.Status.Active:case f.ServerModels.Account.Site.Queue.Chat.Status.Requested:this.startPoll(this.app.pollFast);break;default:this.changePolling(this.pollEnabled,this.app.pollSlow)}},e.prototype.emailTranscript=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(t=this.app.bQuery("[data-beacon-value='email']").value)?(t=t.trim(),[4,this.app.ajax.sendTranscript(this.chat.queue.id,this.chat.id,t)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.uploadFile=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.testFile(i.name,i.size)];case 1:return(t=e.sent()).success?(this.app.bQueryAll("[data-beacon-state~='file']").removeClass("b-file-upload-state-complete b-file-upload-state-failed b-file-upload-state-canceled").addClass("b-file-upload-state-uploading"),this.fileUploadProgress(0,0),[4,this.postFile(i)]):(alert(t.msg),[2]);case 2:return e.sent(),[2]}})})},e.prototype.postFile=function(r){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a=this;return __generator(this,function(e){switch(e.label){case 0:return t=this.app.bQueryAll("[data-beacon-state~='file']"),(i=new FormData).append(r.name,r),this.fileUploadCanceled=!1,this.fileUploadComplete=!1,[4,this.app.ajax.postFileUpload(this.chat.queue.id,this.chat.id,i,function(e){a.fileUploadProgress(e.loaded,e.total)},function(e){a.fileCancelCheck(e)})];case 1:return n=e.sent(),s="b-file-upload-state-complete",t.removeClass("b-file-upload-state-uploading"),n||(s=this.fileUploadCanceled?"b-file-upload-state-canceled":"b-file-upload-state-failed"),t.addClass(s),this.fileUploadComplete=!0,this.fileUploadProgress(0,0),[2]}})})},e.prototype.fileCancelCheck=function(e){var t=this;this.fileUploadCanceled?(e&&e.abort(),this.app.bQuery(".b-dlg-file iframe").setAttribute("src","")):this.fileUploadComplete||setTimeout(function(){t.fileCancelCheck(e)},500)},e.prototype.fileUploadProgress=function(e,t){this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventFileUploadProgressed,{loaded:e,total:t,canceled:this.fileUploadCanceled}))},e.prototype.testFile=function(a,r){return __awaiter(this,void 0,void 0,function(){var t,i,n,s;return __generator(this,function(e){if(t=!0,i="success",r/1e3>this.chat.queue.fileSettings.maxFileSize&&0<this.chat.queue.fileSettings.maxFileSize&&(t=!1,i="file is too large"),this.chat.queue.fileSettings.bannedExt)for(n=0;n<this.chat.queue.fileSettings.bannedExt.length;n++)s=this.chat.queue.fileSettings.bannedExt[n],this.app.stringEndsWith(a,s)&&(t=!1,i="files with this extension cannot be uploaded");return[2,{success:t,msg:i}]})})},e.prototype.printChat=function(){window.open().document.write("<!DOCTYPE html><html><head><link rel='stylesheet' href ='"+this.app.servicePath+"content/css/beacon.css' /><link rel='stylesheet' href ='"+this.app.servicePath+"content/themes/"+this.app.theme+"/css/beacon.css' /></head><body><div class='b-print-doc'>"+this.app.bQuery("["+f.Utility.attrRoleSegmentsEl+"]").innerHTML+NaN)},e.prototype.sendSegment=function(n){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return t=this.app.bQuery("["+f.Utility.attrRoleSegment+"]"),null==(i=n)&&(i=t.value,t.value=""),i?1024<(i=i.trim()).length?(alert("Please limit your chat segment to 1024 characters"),[2]):i.length<1?(t.value="",[2]):[4,this.app.ajax.sendSegment(this.chat.id,i)]:[3,2];case 1:e.sent(),this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventSegmentSent,{text:i})),e.label=2;case 2:return[2]}})})},e.prototype.submitSurvey=function(s){return __awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(e){switch(e.label){case 0:return this.app.session.expired?[4,this.app.restartSession()]:[3,3];case 1:return e.sent(),[4,this.app.ajax.getSurvey(s.queueId)];case 2:t=e.sent(),s.id=t.id,s.chatId=t.chatId,e.label=3;case 3:return i=JSON.parse(JSON.stringify(this.chat)),s.type!=r.PreChat?[3,7]:[4,this.app.ajax.requestChat(s)];case 4:return e.sent(),[4,this.app.ajax.getChat(null)];case 5:return n=e.sent(),[4,this.processChatData(n)];case 6:return e.sent(),[3,11];case 7:return s.type===r.PostChat&&(s.chatId=this.chat.id),[4,this.app.ajax.submitSurvey(s.queueId,s)];case 8:return e.sent(),i.status===b.None?[3,11]:[4,this.app.ajax.getChat(null)];case 9:return n=e.sent(),[4,this.processChatData(n)];case 10:e.sent(),e.label=11;case 11:return this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventSurveySubmitted,s)),[2]}})})},e.prototype.processChatData=function(e){var t=this.chat.status,i=e.chat.status,n=e.request;switch(this.chat=e.chat,this.updateQueue(this.chat.queue),e.chat.status){case f.ServerModels.Account.Site.Queue.Chat.Status.Active:case f.ServerModels.Account.Site.Queue.Chat.Status.Transfer:case f.ServerModels.Account.Site.Queue.Chat.Status.Locked:if(e.chat.segments&&0<e.chat.segments.length){var s=this.getEventCache();s.visible||s.byUser||this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventShowChatWindow,this.app.eventArgsChatWindow(!0,!1)))}this.showGoogleBranding(e.chat.translating);for(var a=!1,r=0,o=e.chat.participants.current;r<o.length;r++){o[r].isTyping&&(a=!0)}a!=this._opTyping&&(this._opTyping=a,this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventOnOpTypingChange,{typing:a}))),e.chat.allowFiles!=this._fileEnabled&&(this._fileEnabled=e.chat.allowFiles,this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventOnFileEnableChange,{enabled:e.chat.allowFiles})));break;case f.ServerModels.Account.Site.Queue.Chat.Status.Requested:if(n&&n.accepted){this.updateWaitTime(n.avgWaitTime);var u=null==n.position?0:n.position;u++;var c=this.app.bQuery("[data-beacon-role='position']");if(c)c.textContent!==u.toString()&&(c.textContent=u.toString());((this.currentRequest=n).timedOut||n.canceled)&&(this.currentRequest=null)}else this.currentRequest=null}n||(this.currentRequest=null),t!=i&&this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventChatStateChanged,this.app.eventArgsChatState(t,i,e.chat.id))),this._banned!==this.app.session.visitor.banned&&(this._banned=this.app.session.visitor.banned,this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventSessionBanned,{banned:this.app.session.visitor.banned})))},e.prototype.handleBanning=function(e){e?this.getChatCtrl().addClass(this.app.bannedClass):this.getChatCtrl().removeClass(this.app.bannedClass)},e.prototype.cancelChatRequest=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.app.ajax.cancelChatRequest(this.chat.queue.id,this.chat.id)];case 1:return e.sent(),this.currentRequest=null,[2]}})})},e.prototype.showGoogleBranding=function(e){var t=this.app.bQueryAll("[data-beacon-role='credit-google']");e?t.addClass("b-google-branding-show"):t.removeClass("b-google-branding-show")},e.prototype.updateQueue=function(e){var t=this.chat.queue.status,i=e.status,n=this.chat.queue.id,s=e.id;return(t!=i||n!=s)&&(this.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventQueueChanged,this.app.eventArgsQueueChange(e))),!0)},e.prototype.updateWaitTime=function(e){if(!(this.waitTimeUpdated||e<1)){this.waitTimeUpdated=!0;for(var t=0,i=0;3600<=e;)t++,e-=3600;for(;60<=e;)i++,e-=60;var n=t.toString(),s=i.toString(),a=e.toString();t<10&&(n="0"+n),i<10&&(s="0"+s),e<10&&(a="0"+a);var r=this.app.bQueryAll("[data-beacon-role='waitTime']").removeClass(".b-waiting-hours .b-waiting-minutes .b-waiting-seconds").appendText("");this.app.bQueryAll("[data-beacon-role='waitTime-h']").appendText(n),this.app.bQueryAll("[data-beacon-role='waitTime-m']").appendText(s),this.app.bQueryAll("[data-beacon-role='waitTime-s']").appendText(a),0<t?r.addClass("b-waiting-hours").appendText(n):0<i?r.addClass("b-waiting-minutes").appendText(s):r.addClass("b-waiting-seconds").appendText(a)}},e.prototype.processQueueTransfer=function(e,t){this.app.session.queueId=e,this.chat.queue.id=e,this.chat.id=0},e.prototype.processSiteTransfer=function(a,r,o){return __awaiter(this,void 0,void 0,function(){var t,i,n,s;return __generator(this,function(e){switch(e.label){case 0:return this.app.session.queueId=r,this.app.session.siteId=a,this.chat.id=0,this.app.session.siteTransfer=!0,[4,this.app.restartSession()];case 1:return e.sent(),this.app.queryStringPairs.skipprechat=o,[4,this.app.ajax.getChat(null)];case 2:return t=e.sent(),i=t.chat,this.chat=null==i?new y:i,[4,this.app.ajax.getSite(a)];case 3:return n=e.sent(),this.site=n,[4,this.app.ajax.getQueue(r)];case 4:return s=e.sent(),this.chat.queue=s,[2]}})})},e.prototype.endChat=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return[4,this.app.ajax.endChat(this.chat)];case 1:return e.sent(),this.app.session.queueId=this.app.chat.defaultQueueId,this.app.session.siteId=this.app.chat.defaultSiteId,(t=JSON.parse(JSON.stringify(this.chat))).status=b.Ended,i={chat:t,request:null,gdprAccepted:!1},this.processChatData(i),[2]}})})},e.prototype.stopPoll=function(){clearTimeout(this.pollId),this.changePolling(!1,this._pollInterval),this.pollComplete=!0,this.pollId=-1},e.prototype.changePolling=function(e,t){this.app.AppCtx===m.Site&&t<this.app.pollSlow&&(t=this.app.pollSlow),this._pollInterval=t,this.pollEnabled=e},e.prototype.startPoll=function(e){var t=this;this.stopPoll();var i=e||this._pollInterval;this.changePolling(!0,i),this.pollId<1&&setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.poll()];case 1:return e.sent(),[2]}})})},50)},e.prototype.poll=function(){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(e){switch(e.label){case 0:if(!(t=this).pollEnabled||!t.pollComplete||t.app.session.expired)return[3,5];t.pollComplete=!1,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.getChatData()];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:t.pollComplete=!0,e.label=5;case 5:return t.pollId=setTimeout(function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.poll()];case 1:return e.sent(),t.app.triggerEvent(new f.Models.BeaconMsg(f.Utility.eventChatPolled,{chat:t.chat})),[2]}})})},t._pollInterval),[2]}})})},e.prototype.getChatData=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return this.app.AppCtx==m.Site&&(this.lastSegId=null),[4,this.app.ajax.getChat(this.lastSegId)];case 1:return null==(t=e.sent()).chat&&(i=JSON.parse(JSON.stringify(this.chat)),t.chat=i),[4,this.processChatData(t)];case 2:return e.sent(),[2,t]}})})},e}(),e.Chat=t}(ChatBeacon||(ChatBeacon={})),function(e){var t,b,i;t=e.Chat||(e.Chat={}),b=e.ServerModels.Account.Site.Queue.Survey.ItemType,i=function(){function e(e,t,i){this._chatId=e,this._segment=t,this._survey=i,this._app=document.beacon}return Object.defineProperty(e.prototype,"ChatBtn",{get:function(){return document.querySelector("button[data-beacon-action='sendSegment']")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SurveyBtn",{get:function(){return document.querySelector("button[data-beacon-role='segment-survey-btn']")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ChatInput",{get:function(){return document.querySelector("textarea[data-beacon-role='segment']")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SurveyInput",{get:function(){return document.querySelector("textarea[data-beacon-role='segment-survey-input']")},enumerable:!0,configurable:!0}),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return[4,this._app.ajax.getChatSurveyHtml()];case 1:return t=e.sent(),document.body.insertAdjacentHTML("beforeend",t),i=document.getElementById("chat-survey-template"),this.template=i.querySelector(".survey-item.item").cloneNode(!0),this.checkboxGroupTemplate=i.querySelector(".survey-item.group").cloneNode(!0),this.radioGroupTemplate=i.querySelector(".survey-item.group").cloneNode(!0),this.subChecboxTemplate=i.querySelector(".subitem.checkbox").cloneNode(!0),this.subRadioTemplate=i.querySelector(".subitem.radio").cloneNode(!0),this.visitorTemplate=i.querySelector(".visitor-segment").cloneNode(!0),document.body.removeChild(i),[2]}})})},e.prototype.generateSurvey=function(e,t){this.ChatInput.addClass("b-display-none"),this.ChatBtn.addClass("b-display-none"),this.SurveyInput.removeClass("b-display-none"),this.SurveyBtn.removeClass("b-display-none"),this._onComplete=t,this._parent=e,this.moveToNext(0)},e.prototype.moveToNext=function(e){if(0<e){var t=this.SurveyInput,i=t.cloneNode(!0);t.parentNode.replaceChild(i,t);var n=this.SurveyBtn,s=n.cloneNode(!0);n.parentNode.replaceChild(s,n)}if(e==this._survey.items.length)this.ChatBtn.removeClass("b-display-none"),this.ChatInput.removeClass("b-display-none"),this.SurveyBtn.addClass("b-display-none"),this.SurveyInput.addClass("b-display-none"),this._onComplete&&this._onComplete();else{var a=this.generateItem(this._survey.items[e]);this._parent.appendChild(a)}},e.prototype.validateItem=function(e,t){t=t.trim();var i=!0;switch(e){case b.Email:i=this.validateEmail(t);break;case b.DateTime:i=!isNaN(new Date(t).valueOf());break;case b.Number:i=!isNaN(parseFloat(t))}return i?this.SurveyInput.parentElement.removeClass("invalid"):this.SurveyInput.parentElement.addClass("invalid"),i},e.prototype.generateItem=function(n){var s,t=this;switch(n.type){case b.Textbox:case b.Name:case b.Email:case b.DateTime:case b.Number:case b.Telephone:case b.Url:s=this.template.cloneNode(!0),this.SurveyInput.addEventListener("keyup",function(i){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this.SurveyInput.value,"Enter"!=i.key?[3,2]:this.validateItem(n.type,t)?[4,this.itemClick(n,s)]:[2];case 1:return e.sent(),[3,3];case 2:t&&0<t.length?this._app.bQuery(".beacon-bar").addClass("typing"):this._app.bQuery(".beacon-bar").removeClass("typing"),e.label=3;case 3:return[2]}})})}),this.SurveyBtn.addEventListener("click",function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this.SurveyInput.value,this.validateItem(n.type,t)?[4,this.itemClick(n,s)]:[2];case 1:return e.sent(),[2]}})})});break;case b.CheckBoxGroup:for(var e=this.checkboxGroupTemplate.cloneNode(!0),i=e.querySelector("[data-beacon-items]"),a=0,r=n.subItems;a<r.length;a++){var o=r[a];(l=this.subChecboxTemplate.cloneNode(!0)).querySelector("[data-beacon-label]").appendText(o.label),l.id="subitem"+o.id.toString(),i.appendChild(l)}s=e,this.SurveyInput.disabled=!0;break;case b.RadioGroup:for(var u=this.radioGroupTemplate.cloneNode(!0),c=(i=u.querySelector("[data-beacon-items]"),0),p=n.subItems;c<p.length;c++){var l;o=p[c];(l=this.subRadioTemplate.cloneNode(!0)).querySelector("[data-beacon-label]").appendText(o.label),l.querySelector("input").setAttribute("name","seg"+this._segment.id.toString()),l.id="subitem"+o.id.toString(),i.appendChild(l)}s=u,this.SurveyInput.disabled=!0}var h=s.querySelector(".op-color"),d=document.getElementById("op"+this._segment.operatorId);d&&h&&(h.style.backgroundColor=d.style.borderColor);var v=s.querySelector("[data-beacon-label]");if(v){var g=v.getAttribute("data-beacon-label");null!=g&&0<g.length?v.setAttribute(g,n.label):v.appendText(n.label)}else{var f=s.querySelector(".text");f&&f.appendText(n.label)}var y=s.querySelector("button");return y&&y.addEventListener("click",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.SurveyInput.disabled=!1,[4,this.itemClick(n,s)];case 1:return e.sent(),[2]}})})}),s},e.prototype.itemClick=function(d,v){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a,r,o,u,c,p,l,h=this;return __generator(this,function(e){switch(e.label){case 0:switch(d.type){case b.Textbox:case b.Name:case b.Email:case b.Telephone:case b.Url:if(t=this.SurveyInput,!(i=t.value.trim())||i.length<1)return[2];d.value=i,(n=this.visitorTemplate.cloneNode(!0)).querySelector(".text").appendText(i),this._parent.appendChild(n),t.value="",setTimeout(function(){h.SurveyInput.focus()},100);break;case b.DateTime:case b.Number:if(t=this.SurveyInput,!(i=t.value.trim())||i.length<1)return[2];d.value=d.type==b.DateTime?new Date(i).valueOf():parseFloat(i),(n=this.visitorTemplate.cloneNode(!0)).querySelector(".text").appendText(i),this._parent.appendChild(n),t.value="",setTimeout(function(){h.SurveyInput.focus()},100);break;case b.CheckBoxGroup:case b.RadioGroup:for(s=0,a=d.subItems;s<a.length;s++)r=a[s],o=v.querySelector("#subitem"+r.id.toString()+" input"),r.value=o.checked}return(u=v.querySelector("button"))&&v.removeChild(u),c=this._survey.items.findIndex(function(e){return e.id==d.id}),p=c==this._survey.items.length-1,this.moveToNext(c+1),[4,this._app.ajax.submitChatSurvey(this._chatId,p,this._survey)];case 1:return e.sent(),l=this._app.bQuery("[data-beacon-role='segments']"),this.scrollTo(l,l.scrollHeight,1e3),[2]}})})},e.prototype.scrollTo=function(e,t,i){var n=this;if(!(i<=0)){var s=(t-e.scrollTop)/i*10;setTimeout(function(){e.scrollTop=e.scrollTop+s,e.scrollTop!==t&&n.scrollTo(e,t,i-10)},10)}},e.prototype.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e}(),t.ChatSurvey=i}(ChatBeacon||(ChatBeacon={})),function(p){!function(e){var c=p.ServerModels.Account.Site.Queue.QueueStatus,i=p.ServerModels.Account.Site.Queue.Chat.Status,n=p.Application.AppContext;e.ButtonType||(e.ButtonType={});var t=function(){function e(){this.pollComplete=!0}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a,r,o,u,c;return __generator(this,function(e){switch(e.label){case 0:return this.app=document.beacon,[4,(t=this).app.ajax.getQueue(this.app.session.queueId)];case 1:return t.queue=e.sent(),[4,this.app.ajax.getChatBtn(this.app.servicePath)];case 2:return i=e.sent(),this.app.queryStringPairs.b&&(this.type=this.app.queryStringPairs.b),null!=(n=this.app.bQuery(".b-chat-btn-loc"))?n.insertAdjacentHTML("beforeend",i):document.body.insertAdjacentHTML("beforeend",i),(s=this.app.bQuery("["+p.Utility.attrRoleBtn+"]")).addClass(this.app.isModern?"b-modern":"b-relic"),a=this.app.ajax.getImgUrl(1,this.app.session.queueId)+"?r="+this.app.getUnique(),(r=this.app.bQuery(".b-icon-queue-server"))&&(r.style.backgroundImage="url("+a+")"),"openWnd"==s.getAttribute(p.Utility.attrAction)&&((o=s.getAttribute(p.Utility.attrOptions))&&(o=JSON.parse(o)),u=o.theme,c={theme:this.app.queryStringPairs.theme,skipprechat:!1,skippostchat:!1,popout:!0,visitorid:null,sessionid:null,origin:null},u&&(c.theme=u),c.skipprechat=!0===this.app.queryStringPairs.skipprechat,c.skippostchat=!0===this.app.queryStringPairs.skippostchat,c.visitorid=this.app.session.visitor.id,c.sessionid=this.app.session.id,c.origin=document.location.origin),this.app.isSecure&&s.addClass("b-secure"),this.wireUpEvents(),this.app.isMobileDevice()&&s.addClass("b-mobile"),this.app.triggerEvent(new p.Models.BeaconMsg(p.Utility.eventQueueChanged,this.app.eventArgsQueueChange(this.queue))),this.poll(),[2]}})})},e.prototype.poll=function(){var e=this;setInterval(function(){return __awaiter(e,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if(!this.pollComplete||this.app.session.expired)return[3,7];if(this.pollComplete=!1,!(0<this.app.bQueryAll("["+p.Utility.attrRoleBtn+"] [data-beacon-state~='queue'], ["+p.Utility.attrRoleBtn+"][data-beacon-state~='queue']").length))return[3,6];e.label=1;case 1:return e.trys.push([1,4,,5]),null!=this.app.monitor||null==this.app.chat||this.app.chat.isActive()||this.app.chat.isRequesting()?[3,3]:[4,this.getQueueState()];case 2:(t=e.sent())!==this.queue.status&&(this.queue.status=t,this.app.triggerEvent(new p.Models.BeaconMsg(p.Utility.eventQueueChanged,this.app.eventArgsQueueChange(this.queue)))),e.label=3;case 3:return[3,5];case 4:return e.sent(),[3,5];case 5:return this.pollComplete=!0,[3,7];case 6:this.pollComplete=!0,e.label=7;case 7:return[2]}})})},this.app.pollMedium)},e.prototype.getQueueState=function(){return this.app.ajax.getQueueState(this.queue.id)},e.prototype.wireUpEvents=function(){var c=this;this.app.openChatWnd.on(function(e){var t=e.args.target,i="button"==t.getAttribute(p.Utility.attrRole),n=t.isChildOfAttr(p.Utility.attrRole,"button");if(i||n){var s;if(i)s=t.getAttribute(p.Utility.attrOptions);else{for(var a=t.parentElement;"button"!=a.getAttribute(p.Utility.attrRole);)a=a.parentElement;s=a.getAttribute(p.Utility.attrOptions)}s&&(s=JSON.parse(s));var r=c.app.getAdditionalParmeters("popout",s.theme);r.c=1;var o=c.app.getWindowUrl(t,r),u=c.app.getWindowOptions(s);c.popup=window.open(o,c.app.windowName,u)}});var e=this.app.bQueryAll("["+p.Utility.attrActionLink+"]"),t=this.app.bQueryAll("["+p.Utility.attrRoleBtn+"]");e.addEventListener("click",function(e){e.preventDefault()}),this.app.queueStateChanged.on(function(e){c.queue=e.args.queue,c.updateUi()}),this.app.sessionBanned.on(function(e){e.args.banned?t.addClass(c.app.bannedClass):t.removeClass(c.app.bannedClass)}),this.app.chatStateChanged.on(function(e){c.updateChatState(e.args.newStatus)}),this.app.windowStateChanged.on(function(e){c.updateBtnOpenClose(e.args.visible)}),this.app.submitSurveyRequest.on(function(e){c.app.chat&&c.app.AppCtx===n.Site&&c.app.postBrowserMSg(e)})},e.prototype.updateBtnOpenClose=function(e){var t=this.app.bQueryAll("["+p.Utility.attrRoleBtn+"]");e?(t.hasClass("b-close")||t.addClass("b-close"),t.removeClass("b-open")):(t.hasClass("b-open")||t.addClass("b-open"),t.removeClass("b-close"))},e.prototype.updateChatState=function(e){var t=this.app.bQueryAll("["+p.Utility.attrRoleBtn+"][data-beacon-state~='chat'], ["+p.Utility.attrRoleBtn+"] [data-beacon-state~='chat']");if(t.removeClassesContaining("b-chat-state-"),null!=this.app.chat)if(this.app.chat.isActive())t.addClass("b-chat-state-active");else switch(this.app.chat.chat.status){case i.None:this.app.chat.chat.queue.status==c.Online?t.addClass("b-chat-state-prechat"):t.addClass("b-chat-state-offline");break;case i.Ended:t.addClass("b-chat-state-postchat");break;default:t.addClass("b-chat-state-"+i[e].toLowerCase())}},e.prototype.updateUi=function(){var e=this.app.bQueryAll("["+p.Utility.attrRoleBtn+"] [data-beacon-state~='queue'], ["+p.Utility.attrRoleBtn+"][data-beacon-state~='queue']"),t=this.app.bQueryAll("["+p.Utility.attrRoleBtn+"].b-queue-state-text, ["+p.Utility.attrRoleBtn+"] .b-queue-state-text");for(var i in t.appendText(""),c)if(c.hasOwnProperty(i)){var n=parseInt(i);if(!isNaN(n)){var s="b-queue-state-"+c[n].toLowerCase();e.removeClass(s),this.queue.status==n&&e.addClass(s)}}var a=this.app.bQueryAll(".b-icon-queue-server");if(0<a.length&&!a.hasClass("b-icon-queue-server-static"))for(var r=this.app.ajax.getImgUrl(1,this.queue.id)+"?r="+this.app.getUnique(),o=0;o<a.length;o++){a[o].style.backgroundImage="url("+r+")"}this.app.bQueryAll("["+p.Utility.attrRoleBtn+"] .b-queue-name").appendText(this.queue.name),this.queue.status==c.Custom&&t.appendText(this.queue.message);var u=this.app.bQuery("["+p.Utility.attrRoleBtn+"]");this.queue.status!=c.Online&&this.queue.hideButtonOffline?u.addClass("b-hide-offline"):u.removeClass("b-hide-offline")},e}();e.Button=t}(p.Monitor||(p.Monitor={}))}(ChatBeacon||(ChatBeacon={})),function(c){var e,r,t;e=c.Monitor||(c.Monitor={}),r=c.ServerModels.Account.Site.Queue.QueueStatus,t=function(){function e(){this.visible=!1}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return this.app=document.beacon,[4,this.app.ajax.getInvites(this.app.servicePath)];case 1:return t=e.sent(),document.body.insertAdjacentHTML("beforeend",t),this.defaultInvite=this.app.bQuery(".b-default-invite").cloneNode(!0),this.textInvite=this.app.bQuery(".b-text-invite").cloneNode(!0),this.custInvite=this.app.bQuery(".b-custom-invite").cloneNode(!0),(i=document.getElementById("b_invites")).parentElement.removeChild(i),this.wireUpEvents(),[2]}})})},e.prototype.accept=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.app.session.expired?[4,this.app.restartSession()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.app.ajax.inviteAccepted(!0)];case 3:return e.sent(),this.hideInvite(),this.app.triggerEvent(new c.Models.BeaconMsg(c.Utility.eventInviteData,{accepted:!0})),[2]}})})},e.prototype.hideInvite=function(){if(this.visible){var e=this.app.bQueryAll("["+c.Utility.attrRoleInvite+"]");switch(e.removeClass("b-invite-txt-show b-invite-def-show b-invite-cust-show b-invite-txt-show-marquee"),this.invite.type){case 1:e.addClass("b-invite-txt-hide");break;case 0:e.addClass("b-invite-def-hide");break;case 2:e.addClass("b-invite-cust-hide")}this.visible=!1}},e.prototype.getQueueState=function(){return this.app.ajax.getQueueState(this.app.queryStringPairs.queueid)},e.prototype.wireUpEvents=function(){var u=this;this.app.queueStateChanged.on(function(e){var t=e.args.queue;u.queueState=t.status,u.queueState!==r.Online&&u.hideInvite()}),this.app.inviteChanged.on(function(t){return __awaiter(u,void 0,void 0,function(){return __generator(this,function(e){return t.args.invite&&this.update(t.args.invite),[2]})})}),this.app.sessionBanned.on(function(e){e.args.banned?u.app.bQueryAll("["+c.Utility.attrRoleInvite+"]").addClass(u.app.bannedClass):u.app.bQueryAll("["+c.Utility.attrRoleInvite+"]").removeClass(u.app.bannedClass)}),this.app.openChatWnd.on(function(e){var t=e.args.target;if(t.getAttribute){var i="invite"==t.getAttribute("data-beacon-role"),n=t.isChildOfAttr("data-beacon-role","invite");if(!i&&!n)return;var s=t.getAttribute(c.Utility.attrOptions);s&&(s=JSON.parse(s));var a=u.app.getAdditionalParmeters("popout",s.theme);a.skipprechat=!0,a.skippostchat=!0===u.app.queryStringPairs.skippostchat,a.c=1;var r=u.app.getWindowUrl(t,a),o=u.app.getWindowOptions(s);window.open(r,u.app.windowName,o)}})},e.prototype.decline=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.app.session.expired?[4,this.app.restartSession()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.app.ajax.inviteAccepted(!1)];case 3:return e.sent(),this.hideInvite(),this.app.triggerEvent(new c.Models.BeaconMsg(c.Utility.eventInviteData,{accepted:!1})),[2]}})})},e.prototype.showInvite=function(e){if(void 0===e&&(e=this.invite.type),!this.visible){var t=this.app.bQueryAll("["+c.Utility.attrRoleInvite+"]");if(t.removeClass("b-invite-txt-hide b-invite-def-hide b-invite-cust-hide b-invite-txt-hide-marquee"),this.app.bQuery("[data-beacon-role='marquee']"))switch(e){case 1:t.addClass("b-invite-txt-show-marquee");break;case 0:t.addClass("b-invite-def-show-marquee");break;case 2:t.addClass("b-invite-cust-show-marquee")}else switch(e){case 1:t.addClass("b-invite-txt-show");break;case 0:t.addClass("b-invite-def-show");break;case 2:t.addClass("b-invite-cust-show")}this.visible=!0}},e.prototype.update=function(e){var t=this;if(null==this.invite||this.invite.type!==e.type){for(var i=this.app.bQueryAll("["+c.Utility.attrRoleInvite+"]"),n=i.length-1;0<=n;n--)i[n]&&i[n].parentElement&&i[n].parentElement.removeChild(i[n]);var s=void 0;switch(e.type){case 1:s=this.textInvite.cloneNode(!0);break;case 0:s=this.defaultInvite.cloneNode(!0);break;case 2:s=this.custInvite.cloneNode(!0)}s&&document.body.appendChild(s),this.app.bQueryAll("["+c.Utility.attrRoleInvite+"] .b-invite-decline").addEventListener("click",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.decline()];case 1:return e.sent(),[2]}})})}),this.app.bQueryAll("["+c.Utility.attrRoleInvite+"] .b-invite-accept").addEventListener("click",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.accept()];case 1:return e.sent(),[2]}})})}),e.text&&this.app.bQueryAll("["+c.Utility.attrRoleInvite+"] .b-invite-text").appendText(e.text)}var a=this.app.bQueryAll("["+c.Utility.attrRoleInvite+"]");a.addClass(this.app.isModern?"b-modern":"b-relic"),this.app.isSecure&&a.addClass("b-secure"),this.invite=e,this.queueState===r.Online&&this.showInvite(e.type),this.queueState!==r.Online&&this.hideInvite()},e}(),e.Invite=t}(ChatBeacon||(ChatBeacon={})),function(n){var e,s,i,t;e=n.Monitor||(n.Monitor={}),s=n.ServerModels.Account.Site.Session.InviteStatus,i=n.ServerModels.Account.Rules.ActionType,t=function(){function e(){this.pollComplete=!0,this.pollEnabled=!1}return e.prototype.addPage=function(){var e=document.location.protocol+"//"+document.location.hostname+document.location.pathname,t=document.referrer,i=document.title,n=document.location.search;return this.app.ajax.addPage(e,t,i,"",n)},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,s=this;return __generator(this,function(e){switch(e.label){case 0:return this.app=document.beacon,this.wireUpEvents(),[4,this.addPage()];case 1:return e.sent(),this.app.session.visitor.banned=this.app.isBanned(),[4,this.app.ajax.getMarquee(this.app.servicePath)];case 2:return t=e.sent(),(i=document.createElement("div")).innerHTML=t,this.marquee=i.firstChild,this.marquee.querySelectorAll(".close-marquee").addEventListener("click",function(e){e.stopPropagation(),s.marquee.removeMe()}),this.app.theme.toLowerCase().indexOf("blue")&&this.marquee.addClass("blue"),[4,this.app.ajax.getSync()];case 3:return n=e.sent(),this.processMonitor(n),this.poll(),[2]}})})},e.prototype.wireUpEvents=function(){var t=this;this.app.windowStateChanged.on(function(e){e.args.visible&&t.marquee.removeMe()})},e.prototype.processMonitor=function(e){if(e.pushUrl&&e.pushUrl.url&&e.pushUrl.push&&(window.location.href=e.pushUrl.url),null!=e.invite&&e.invite.status==s.Invited&&this.app.triggerEvent(new n.Models.BeaconMsg(n.Utility.eventInviteData,{invite:e.invite,accepted:!1})),e.session.visitor.banned!==this.app.session.visitor.banned&&(this.app.setBan(e.session.visitor.banned),this.app.triggerEvent(new n.Models.BeaconMsg(n.Utility.eventSessionBanned,{banned:e.session.visitor.banned}))),null!=e.ruleActions)for(var t=0;t<e.ruleActions.length;t++)this.processRuleAction(e.ruleActions[t]);if(e.queue&&e.queue.status!==this.queueStatus&&(this.queueStatus=e.queue.status,this.app.triggerEvent(new n.Models.BeaconMsg(n.Utility.eventQueueChanged,this.app.eventArgsQueueChange(e.queue)))),e.session.queueId=this.app.session.queueId,e.session.accountId=this.app.session.accountId,e.session.siteTransfer=this.app.session.siteTransfer,e.session.data)for(t=0;t<e.session.data.length;t++){var i=e.session.data[t];switch(i.name){case"upscope":window.Upscope;break;case"median":this.app.screenShareId||(window.Median?this.app.updateScreenShareId(this.app.session.id):this.app.insertMedian(i.value))}}this.app.session=e.session},e.prototype.poll=function(){var e=this;setInterval(function(){return __awaiter(e,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return!this.pollComplete||this.app.session.expired?[3,2]:(this.pollComplete=!1,[4,this.app.ajax.getSync()]);case 1:t=e.sent(),this.processMonitor(t),this.pollComplete=!0,e.label=2;case 2:return[2]}})})},this.app.pollSlow)},e.prototype.processRuleAction=function(e){switch(e.actionType){case i.PushSession:window.location.href=e.value;break;case i.ExecuteScript:var t=document.createElement("script");t.innerText=e.value,document.body.appendChild(t);break;case i.HideInvite:this.app.invite.hideInvite();break;case i.HideWindow:this.app.chat.hideChatCtrl();break;case i.ShowMarquee:this.marquee.querySelector("[data-beacon='text']").innerHTML=e.value,document.body.appendChild(this.marquee)}},e}(),e.Monitor=t}(ChatBeacon||(ChatBeacon={})),function(h){var e,r,s,o,t;e=h.Api||(h.Api={}),r=h.ServerModels.Account.Site.Queue.Chat.Segment.Visitor.VisitorSegment,s=h.ServerModels.Account.Site.Queue.Chat.Segment.SegmentType,o=h.ServerModels.Account.Site.Queue.Chat.Segment.Translation,t=function(){function e(){this.isCrossDomain=!1,this.requiresJsonp=!1}return e.prototype.init=function(){var e,t,i;this.app=document.beacon,this.isCrossDomain=(e=this.app.servicePath,t=window.location,(i=document.createElement("a")).href=e,!(i.hostname===t.hostname&&i.port===t.port&&i.protocol===t.protocol));var n=document.createElement("a");n.href=this.app.servicePath,this.corsHost=n.hostname,this.corsOrigin=document.location.protocol+"//"+document.location.hostname,this.isHttps="https:"===document.location.protocol,this.requiresJsonp=!1},e.prototype.addPage=function(e,t,i,n,s){var a=new h.ServerModels.Account.Site.Page;a.url=e,a.referrer=t,a.title=i,a.queryString=s;var r=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/session/page";return this.requestX(r,h.Utility.postVerb,a)},e.prototype.serializeToQueryString=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},e.prototype.requestX=function(t,o,u,c,p){var l=this;return new Promise(function(i,n){var e=null;null!=u&&(o!==h.Utility.getVerb?e=JSON.stringify(u):(t+="?"+l.serializeToQueryString(u),u=null));var s=new XMLHttpRequest;"withCredentials"in s||(s=new window.XDomainRequest);var a="application/json";-1<t.indexOf("?")?t+="&r="+(new Date).valueOf():t+="?r="+(new Date).valueOf(),s.open(o,t),null==c&&(c=a),null==p&&(p="application/json, text/javascript, */*; q=0.01"),s.setRequestHeader("Content-Type",c),s.setRequestHeader("Accept",p),-1<t.indexOf("beacon")&&s.setRequestHeader("x-chatbeacon",l.app.session.visitor.id+":"+l.app.session.id);var r=l;s.onload=function(e){if(200<=s.status&&s.status<300){var t=null;t=s.responseText&&c==a?JSON.parse(s.responseText):s.responseText,i(t)}else 401!==s.status&&500!==s.status||(r.app.session.expired=!0,r.app.session.id=h.Utility.emptyGuid,r.app.setSessionCache()),n({status:s.status,statusText:s.statusText})},s.onerror=function(){401!==s.status&&500!==s.status||(r.app.session.expired=!0,r.app.session.id=h.Utility.emptyGuid,r.app.setSessionCache()),n({status:s.status,statusText:s.statusText})},s.send(e)})},e.prototype.getControllerUrl=function(e,t){var i="/api/v1/account/"+this.app.session.accountId+"/visitor/"+this.app.session.visitor.id+"/site/"+this.app.session.siteId+"/session/"+this.app.session.id,n="/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId;switch(e.toLowerCase()){case"session":break;case"survey":t?(i=n+"/queue/"+t.p1+"/survey",t.p2&&(i+="/type/"+t.p2)):i=n+"/queue/survey";break;case"queue":if(i=n+"/queue/",t)for(var s in t)t.hasOwnProperty(s)&&(i+=t[s]);break;case"img":i+="/img/type/"+t.p1+"/"+t.p2;break;case"request":i=n+"/queue/request/";break;case"segment":case"chat":i=n+"/queue/chat/";break;case"site":i=n;break;case"template":i="/api/v1/template/"+t.theme+"/"+t.template;break;case"page":case"profile":i=n+"/"+e;break;case"invite":i+="/"+e}return this.app.servicePath+i},e.prototype.getSession=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/session",[4,this.requestX(t,h.Utility.getVerb,null)];case 1:return[2,e.sent()]}})})},e.prototype.getSync=function(){var e=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/session/sync";return this.requestX(e,h.Utility.getVerb)},e.prototype.createSession=function(r){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a;return __generator(this,function(e){switch(e.label){case 0:return t=screen.width+"x"+screen.height+"x"+screen.colorDepth,i=this.app.gdprAccepted(),n={queueId:r,resolution:t,gdpr:i},s=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/session",[4,this.requestX(s,h.Utility.postVerb,n)];case 1:return(a=e.sent()).expired=!1,[2,a]}})})},e.prototype.inviteAccepted=function(e){var t=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/session/invite",i=e?h.ServerModels.Account.Site.Session.InviteStatus.Accepted:h.ServerModels.Account.Site.Session.InviteStatus.Declined;return this.requestX(t,"put",{status:i})},e.prototype.getImgUrl=function(e,t){return this.getControllerUrl("img",{p1:e,p2:t})},e.prototype.updateVisitorProfile=function(e){var t=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/profile";return this.requestX(t,h.Utility.putVerb,e)},e.prototype.updateScreenShareId=function(e){var t=this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId+"/screenshare";return this.requestX(t,h.Utility.postVerb,{screenShareId:e})},e.prototype.getProfile=function(){return this.requestX(this.getControllerUrl("profile"),h.Utility.getVerb)},e.prototype.getQueueState=function(e){var t=this.getControllerUrl("queue",{p1:e,p2:"/status"});return this.requestX(t,h.Utility.getVerb)},e.prototype.getInvites=function(e){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"invites"}),h.Utility.getVerb)},e.prototype.getMarquee=function(e){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"marquee"}),h.Utility.getVerb)},e.prototype.getChatBtn=function(e){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"button"}),h.Utility.getVerb)},e.prototype.getChatSurveyHtml=function(){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"chatsurvey"}),h.Utility.getVerb)},e.prototype.getApiUrl=function(){return this.app.servicePath+"/api/v2/account/"+this.app.session.accountId+"/visitor/site/"+this.app.session.siteId},e.prototype.getSite=function(e){return this.requestX(this.getApiUrl(),h.Utility.getVerb)},e.prototype.getQueue=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this.getApiUrl()+"/queue/"+i,[4,this.requestX(t,h.Utility.getVerb,null)];case 1:return[2,e.sent()[0]]}})})},e.prototype.getSiteQueues=function(){var e=this.getApiUrl()+"/queue";return this.requestX(e,h.Utility.getVerb,null)},e.prototype.getChatWnd=function(e){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"chatwindow"}),h.Utility.getVerb)},e.prototype.getSurveyHtml=function(e){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"surveyfields"}),h.Utility.getVerb)},e.prototype.getSurveyPreview=function(e,t,i){void 0===i&&(i=!1);var n="/api/v1/account/"+this.app.session.accountId+"/site/"+this.app.session.siteId+"/queue/"+e+"/survey/"+t;return i&&(n+="/preview"),this.requestX(this.app.servicePath+n,h.Utility.getVerb)},e.prototype.getSegmentHtml=function(e){return this.requestX(this.getControllerUrl("template",{theme:this.app.theme,template:"segments"}),h.Utility.getVerb)},e.prototype.submitSurvey=function(e,t){var i=this.getApiUrl()+"/queue/"+e+"/survey";return this.requestX(i,h.Utility.putVerb,t)},e.prototype.requestChat=function(e){var t=this.getControllerUrl("request");return this.requestX(t,h.Utility.postVerb,e)},e.prototype.getMediaUrl=function(e,t,i){if(i&&0==i.toLowerCase().indexOf("http"))return i;var n=this.app.servicePath+"/media.ashx?accountid="+this.app.session.accountId+"&siteid="+this.app.session.siteId+"&visitorid="+this.app.session.visitor.id+"&sessionid="+this.app.session.id;return e&&(n+="&chatid="+e),t&&(n+="&media="+t),n},e.prototype.getSurvey=function(e,t){var i=this.getApiUrl()+"/queue/"+e+"/survey";return t&&(i+="/"+t),this.requestX(i,h.Utility.getVerb,null)},e.prototype.endChat=function(e){var t=this.getControllerUrl("chat");return this.requestX(t,"delete",null)},e.prototype.getChatRequest=function(e){return this.requestX(this.getControllerUrl("request",{p1:e}),h.Utility.getVerb)},e.prototype.getChat=function(e){var t=null;return null!=e&&(t={since:e}),this.requestX(this.getControllerUrl("chat"),h.Utility.getVerb,t)},e.prototype.sendSegmentPreview=function(e,t,i){var n=new r;return n.text=i,n.chatId=t,n.type=s.VisitorPreview,this.postNewSegment(n)},e.prototype.postNewSegment=function(e){var t=this.getControllerUrl("segment");return this.requestX(t,h.Utility.putVerb,e)},e.prototype.cancelChatRequest=function(e,t){var i=this.getControllerUrl("request",{p1:e,p2:t});return this.requiresJsonp?this.requestX(i+"/cancelrequest",h.Utility.getVerb,null):this.requestX(i,"delete",null)},e.prototype.sendSegmentTranslated=function(e,t,i,n,s){var a=new r;return a.text=t,a.translation=new o,a.translation.text=i,a.translation.source=n,a.translation.target=s,a.chatId=e,this.postNewSegment(a)},e.prototype.sendSegment=function(e,t){var i=new r;return i.text=t,i.chatId=e,this.postNewSegment(i)},e.prototype.sendTranscript=function(e,t,i){var n={Email:i,Id:t},s=this.getControllerUrl("chat",{p1:e,p2:t})+"/sendnotification";return this.requiresJsonp?this.requestX(s,h.Utility.getVerb,{notification:JSON.stringify(n)}):this.requestX(s,h.Utility.putVerb,n)},e.prototype.notifyOfUpload=function(e,t,i){var n=this.getControllerUrl("chat",{p1:e,p2:t}),s={Id:t,FileBeingUploaded:i};return this.requiresJsonp?this.requestX(n+"/sendnotification",h.Utility.getVerb,{notification:JSON.stringify(s)}):this.requestX(n,h.Utility.putVerb,s)},e.prototype.postFileUpload=function(n,s,a,r,o){var u=this,c=this.getPostFileUrl(n,s);return new Promise(function(t,i){var e=new XMLHttpRequest;e.upload.addEventListener("progress",function(e){e.lengthComputable&&r({loaded:e.loaded,total:e.total})}),e.addEventListener("load",function(e){t(200==e.currentTarget.status)}),e.addEventListener("error",function(t){return __awaiter(u,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 400!=t.currentTarget.status?[3,2]:[4,this.notifyOfUpload(n,s,!1)];case 1:e.sent(),e.label=2;case 2:return i(!1),[2]}})})}),e.open("POST",c,!0),e.send(a),o(e)})},e.prototype.getPostFileUrl=function(e,t){return this.app.servicePath+"/media.ashx?accountid="+this.app.session.accountId+"&siteid="+this.app.session.siteId+"&chatid="+t+"&visitorid="+this.app.session.visitor.id+"&sessionid="+this.app.session.id+"&queueid="+e},e.prototype.updateGdpr=function(e){var t=this.getApiUrl();return t+="/gdpr",this.app.setGdpr(e),this.requestX(t,h.Utility.putVerb,e)},e.prototype.submitChatSurvey=function(e,t,i){var n=this.getApiUrl()+"/queue/chat/survey",s={chatId:e,completed:t,survey:i};return this.requestX(n,h.Utility.postVerb,s)},e.prototype.getHistory=function(e){var t=this.getApiUrl()+"/history";return 0<e&&(t+="/"+e),this.requestX(t,h.Utility.getVerb)},e.prototype.resumeChat=function(e){var t=this.getApiUrl()+"/history/resume",i={chatId:e};return this.requestX(t,h.Utility.postVerb,i)},e}(),e.ApiClient=t}(ChatBeacon||(ChatBeacon={})),function(o){var s,e;s=o.Application||(o.Application={}),e=function(){function e(){this.servicePath="",this.queryStringPairs={},this.jqueryRequested=!1,this.windowQueryStringPairs={},this.eventSenders={button:"button",chat:"chat"},this.theme="frame",this.isModern=!0,this.isSecure=!1,this.pollSlow=5e3,this.pollFast=1e3,this.pollMedium=5e3,this.themePath=null,this.sessionCreateAttempts=0,this.windowName="BeaconChatWindow",this.bannedClass="b-session-banned",this.parseVariables=!0,this.loadingExternals=!0,this.externalsCount=0,this.restoreCache();var e=this.getScriptPath(o.Utility.scriptName);""==e&&(e=this.getScriptPath(o.Utility.wndScriptName));var t=e.indexOf("scripts");this.ajax=new o.Api.ApiClient,this.session=new o.ServerModels.Account.Site.Session.Session;var i=-1<t?e.substr(0,t):e;this.servicePath=null!=o.Utility.serviceUrl?o.Utility.serviceUrl:i,-1!==(t=this.servicePath.indexOf("/",this.servicePath.length-1))&&(this.servicePath=this.servicePath.substring(0,t)),this.onWindowStateChange=new o.Models.BeaconEvent,this.onChatStateChange=new o.Models.BeaconEvent,this.onInviteChange=new o.Models.BeaconEvent,this.onQueueStateChange=new o.Models.BeaconEvent,this.onSurveyRendered=new o.Models.BeaconEvent,this.onSurveyItemMissing=new o.Models.BeaconEvent,this.onSubmitSurveyRequest=new o.Models.BeaconEvent,this.onEndRequestRequest=new o.Models.BeaconEvent,this.onEndChatRequest=new o.Models.BeaconEvent,this.onPrintChatRequest=new o.Models.BeaconEvent,this.onEmailChatRequest=new o.Models.BeaconEvent,this.onSendSegmentRequest=new o.Models.BeaconEvent,this.onOpenChatWnd=new o.Models.BeaconEvent,this.onSessionBanned=new o.Models.BeaconEvent,this.onAlterCssRequest=new o.Models.BeaconEvent,this.onModuleInit=new o.Models.BeaconEvent,this.onChatPolled=new o.Models.BeaconEvent,this.onFileUploadProgress=new o.Models.BeaconEvent,this.onSegmentSent=new o.Models.BeaconEvent,this.onSurveySubmitted=new o.Models.BeaconEvent,this.onSegmentsProcessed=new o.Models.BeaconEvent,this.onSegmentRendered=new o.Models.BeaconEvent,this.onParentResize=new o.Models.BeaconEvent,this._onSessionRestart=new o.Models.BeaconEvent,this._onGdprUpdate=new o.Models.BeaconEvent,this._fileEnabledChanged=new o.Models.BeaconEvent,this._operatorTypingChanged=new o.Models.BeaconEvent,this._inputFocused=new o.Models.BeaconEvent}return Object.defineProperty(e.prototype,"AppCtx",{get:function(){return this._appCtx},enumerable:!0,configurable:!0}),e.prototype.postBrowserMSg=function(e){switch(this._appCtx){case s.AppContext.Site:try{var t=this.bQuery("[data-beacon-role='chat']").querySelector("iframe"),i=null==o.Utility.staticUrl?this.getRootUrl(this.servicePath):this.getRootUrl(o.Utility.staticUrl);t.contentWindow.postMessage(e,i)}catch(e){}break;case s.AppContext.Iframe:window.parent.postMessage(e,this.queryStringPairs.origin);break;case s.AppContext.Popout:window.parent.postMessage(e,document.location.origin)}},e.prototype.insertExternals=function(){var e=this;if("undefined"==typeof Promise){this.externalsCount++;var t=document.createElement("script");t.type="text/javascript",t.src=this.servicePath+"/scripts/es6-promise.auto.min.js",t.onload=function(){e.externalsCount--},document.head.appendChild(t)}this.waitForExternals()},e.prototype.waitForExternals=function(){var e=this;0<this.externalsCount?setTimeout(function(){e.waitForExternals()},100):this.init()},e.prototype.bQuery=function(e){return document.querySelector(e)},e.prototype.bQueryAll=function(e){return document.querySelectorAll(e)},Object.defineProperty(e.prototype,"segmentRendered",{get:function(){return this.onSegmentRendered.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsProcessed",{get:function(){return this.onSegmentsProcessed.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surveySubmitted",{get:function(){return this.onSurveySubmitted.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentSent",{get:function(){return this.onSegmentSent.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileUploadProgressed",{get:function(){return this.onFileUploadProgress.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatPolled",{get:function(){return this.onChatPolled.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moduleInitialized",{get:function(){return this.onModuleInit.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alterCssRequest",{get:function(){return this.onAlterCssRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionBanned",{get:function(){return this.onSessionBanned.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openChatWnd",{get:function(){return this.onOpenChatWnd.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sendSegmentRequest",{get:function(){return this.onSendSegmentRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emailChatRequest",{get:function(){return this.onEmailChatRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"printChatRequest",{get:function(){return this.onPrintChatRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endChatRequest",{get:function(){return this.onEndChatRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endRequestRequest",{get:function(){return this.onEndRequestRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"submitSurveyRequest",{get:function(){return this.onSubmitSurveyRequest.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"windowStateChanged",{get:function(){return this.onWindowStateChange.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatStateChanged",{get:function(){return this.onChatStateChange.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inviteChanged",{get:function(){return this.onInviteChange.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queueStateChanged",{get:function(){return this.onQueueStateChange.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surveyRendered",{get:function(){return this.onSurveyRendered.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surveyItemMissing",{get:function(){return this.onSurveyItemMissing.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentResized",{get:function(){return this.onParentResize.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionRestarted",{get:function(){return this._onSessionRestart.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gdprUpdated",{get:function(){return this._onGdprUpdate.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileEnabledChanged",{get:function(){return this._fileEnabledChanged.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opTypingChanged",{get:function(){return this._operatorTypingChanged.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputFocused",{get:function(){return this._inputFocused.expose()},enumerable:!0,configurable:!0}),e.prototype.getScriptPath=function(e){for(var t="",i=document.getElementsByTagName("script"),n=0;n<i.length;n++){var s=i[n].src.toLowerCase(),a=s.indexOf(e);if(-1<a){t=s.substr(0,a);break}}return t},e.prototype.getElementPosition=function(e){for(var t=0,i=0;e;){if("BODY"===e.tagName){var n=e.scrollLeft||document.documentElement.scrollLeft,s=e.scrollTop||document.documentElement.scrollTop;t+=e.offsetLeft-n+e.clientLeft,i+=e.offsetTop-s+e.clientTop}else t+=e.offsetLeft-e.scrollLeft+e.clientLeft,i+=e.offsetTop-e.scrollTop+e.clientTop;e=e.offsetParent}return{x:t,y:i}},e.prototype.stringEndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.prototype.to12HourTimeString=function(e){var t=e.getHours(),i=e.getMinutes(),n="a.m.";return 12<=t&&(t-=12,n="p.m."),(t=0===t?12:t)+":"+(i<10?"0":"")+i+" "+n},e.prototype.parseIso8601=function(e){return o.Utility.Util.parseIso8601(e)},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if(this.windowQueryStringPairs=this.getQueryStringPairs(window.location.search.substring(1)),this.windowQueryStringPairs.beaconop)return[2];for(t in this.queryStringPairs=this.getQueryStringPairs(this.getScriptQueryString(o.Utility.scriptName)),this.windowQueryStringPairs)this.windowQueryStringPairs.hasOwnProperty(t)&&(this.queryStringPairs[t]=this.windowQueryStringPairs[t]);return this.queryStringPairs.theme&&(this.theme=this.queryStringPairs.theme),this.themePath=null!=o.Utility.staticUrl?o.Utility.staticUrl:this.servicePath+"/content/themes/"+this.theme,this.isSecure="https:"===document.location.protocol,this.insertScripts(),[4,this.loadApplication()];case 1:return e.sent(),[2]}})})},e.prototype.insertScripts=function(){var e=null!=o.Utility.staticUrl?o.Utility.staticUrl:this.servicePath,t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e+"/content/css/chatbeacon.css"),document.head.appendChild(t),(t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e+"/content/themes/"+this.theme+"/css/chatbeacon.css"),document.head.appendChild(t),(t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e+"/content/themes/"+this.theme+"/css/custom.css"),document.head.appendChild(t)},e.prototype.insertMedian=function(t){var e=this,i=null!=o.Utility.staticUrl?o.Utility.staticUrl:this.servicePath,n=document.createElement("script");n.type="text/javascript",n.addEventListener("load",function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return window.Median.on("sesssion started",function(){console.log("session started")}),window.Median.init(t),[4,this.updateScreenShareId(this.session.id)];case 1:return e.sent(),[2]}})})}),n.src=i+"/scripts/median.js",document.body.appendChild(n)},e.prototype.updateScreenShareId=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.screenShareId=t,window.Median.identify(t),[4,this.ajax.updateScreenShareId(t)];case 1:return e.sent(),[2]}})})},e.prototype.loadApplication=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n=this;return __generator(this,function(e){switch(e.label){case 0:this.ajax.init(),this.wireUpEvents(),t=!1,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.getSession()];case 2:return e.sent(),[3,4];case 3:return e.sent(),t=!0,[3,4];case 4:return t?[4,this.restartSession()]:[3,6];case 5:e.sent(),e.label=6;case 6:return this.parseVariables?[4,this.sendVariables()]:[3,8];case 7:e.sent(),e.label=8;case 8:return[4,(i=this).ajax.getProfile()];case 9:return i.profile=e.sent(),0<this.queryStringPairs.m?(this.monitor=new o.Monitor.Monitor,[4,this.monitor.init()]):[3,12];case 10:return e.sent(),0<this.queryStringPairs.i?(this.invite=new o.Monitor.Invite,[4,this.invite.init()]):[3,12];case 11:e.sent(),e.label=12;case 12:return 0<this.queryStringPairs.c||this.windowQueryStringPairs.popout?(0<this.queryStringPairs.b&&this.moduleInitialized.on(function(i){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return"chat"!=i.args.module||i.args.type!=s.AppContext.Iframe||this.AppCtx!=s.AppContext.Site?[3,2]:(this.button=new o.Monitor.Button,[4,this.button.init()]);case 1:e.sent(),this.button.updateChatState(this.chat.chat.status),this.button.updateBtnOpenClose(this.chat.ctrlIsVisible()),e.label=2;case 2:return i.args.theme&&(t=this.bQuery("[data-beacon-role='button']"))&&t.addClass(i.args.theme),[2]}})})}),this.chat=new o.Chat.Chat,[4,this.chat.init()]):[3,14];case 13:return e.sent(),[3,16];case 14:return 0<this.queryStringPairs.b?(this.button=new o.Monitor.Button,[4,this.button.init()]):[3,16];case 15:e.sent(),e.label=16;case 16:return[2]}})})},e.prototype.setAppContext=function(e){this._appCtx=e},e.prototype.sendVariables=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,s;return __generator(this,function(e){switch(e.label){case 0:for(n in(t=new o.ServerModels.Account.Visitor.VisitorProfile).variables=new Array,i=this.queryStringPairs)if(i.hasOwnProperty(n)){switch(n){case"b":case"c":case"i":case"m":case"skipprechat":case"skippostchat":case"theme":case"accountid":case"siteid":case"queueid":case"popout":case"visitorid":case"sessionid":case"origin":case"multiq":case"type":continue}(s=new o.ServerModels.Account.Site.Variable).name=n,s.value=this.queryStringPairs[n],t.variables.push(s)}return 0<t.variables.length?[4,this.ajax.updateVisitorProfile(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.getScriptQueryString=function(e){for(var t=document.getElementsByTagName("script"),i=0;i<t.length;i++){var n=t[i];if(-1<n.src.indexOf(e)){var s=n.src.indexOf("?");return n.src.substr(s+1)}}return null},e.prototype.getQueryStringPairs=function(e){var t={};if(null==e)return t;for(var i,n=e.split("&"),s=0;s<n.length;s++){var a=n[s].indexOf("=");if(0<a){var r=n[s].substring(0,a),o=n[s].substring(a+1);switch(r.toLowerCase()){case"b":case"c":case"i":case"m":case"skipprechat":case"skippostchat":case"theme":case"accountid":case"siteid":case"queueid":case"sessionid":case"visitorid":r=r.toLowerCase()}if(i=o,isNaN(i-0)||null===i||""===i||!1===i){var u=o.toLowerCase();o="true"===u||"false"!==u&&("undefined"===u?void 0:decodeURIComponent(o))}else o=parseInt(o);t[r]=o}}return t},e.prototype.getSessionCache=function(){var e=this.session;try{((e=this._sessionCache.session).id===o.Utility.emptyGuid||this.queryStringPairs.sessionid||null==e.id)&&(e.id=this.getSessionId()),(e.visitor.id===o.Utility.emptyGuid||this.queryStringPairs.visitorid||null==e.visitor.id)&&(e.visitor.id=this.getVisitorId()),e.siteTransfer||(e.accountId=this.queryStringPairs.accountid,e.queueId=this.queryStringPairs.queueid,this.queryStringPairs.siteid==e.siteId||this.queryStringPairs.sessionid||(e.id=o.Utility.emptyGuid),e.siteId=this.queryStringPairs.siteid)}catch(e){}return e},e.prototype.getSessionId=function(){var e=null;try{this.queryStringPairs.sessionid?(e=this.queryStringPairs.sessionid,this._sessionCache.session.id=e,this.setCache()):e=this._sessionCache.session.id}catch(e){}return e||o.Utility.emptyGuid},e.prototype.getCookie=function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var s=i[n];" "===s.charAt(0);)s=s.substring(1);if(-1!==s.indexOf(t))return s.substring(t.length,s.length)}return""},e.prototype.getVisitorId=function(){var e=null;try{this.queryStringPairs.visitorid?(e=this.queryStringPairs.visitorid,this._cache.visitor.id=e,this.setCache()):e=this._cache.visitor.id}catch(e){}return e||o.Utility.emptyGuid},e.prototype.getSession=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,a,r=this;return __generator(this,function(e){switch(e.label){case 0:return this.sessionCreateAttempts++,this.session=this.getSessionCache(),t=function(e){r.setSessionId(e.id),r.setVisitorId(e.visitor.id),e.accountId=r.session.accountId,e.siteTransfer=r.session.siteTransfer,e.queueId=r.session.queueId,r.session=e,console.log("session expired: "+r.session.expired),r.setSessionCache()},this.session.visitor.id===o.Utility.emptyGuid||this.session.id===o.Utility.emptyGuid||this.session.expired?[4,this.ajax.createSession(this.session.queueId)]:[3,2];case 1:return n=e.sent(),t(n),[3,8];case 2:i=!1,e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.ajax.getSession()];case 4:return n=e.sent(),t(n),[3,6];case 5:return e.sent(),i=!0,[3,6];case 6:return i&&this.sessionCreateAttempts<5?(s=JSON.stringify(this.session),(a=JSON.parse(s)).id=o.Utility.emptyGuid,t(a),[4,this.getSession()]):[3,8];case 7:e.sent(),e.label=8;case 8:return[2]}})})},e.prototype.setSessionId=function(e){this._sessionCache.session.id=e,this.setCache()},e.prototype.setVisitorId=function(e){this._cache.visitor.id=e,this.setCache()},e.prototype.setSessionCache=function(){this._sessionCache.session=this.session,this.setCache()},e.prototype.getWindowUrl=function(e,t){var i=(null==o.Utility.staticUrl?this.servicePath:o.Utility.staticUrl)+"/content/windows/chat.html?",n=this.queryStringPairs;for(var s in n)if(n.hasOwnProperty(s)){if(t&&t[s])continue;switch(s){case"b":case"c":case"i":case"m":case"skipprechat":case"skippostchat":case"theme":break;default:i+="&"+s+"="+this.queryStringPairs[s]}}if(t)for(var s in t)t.hasOwnProperty(s)&&(i+="&"+s+"="+t[s]);return i},e.prototype.getWindowOptions=function(e){var t="";if(e)for(var i in e)e.hasOwnProperty(i)&&(t+=i+"="+e[i]+",");return t},e.prototype.getUnique=function(){var e=new Date;return e.getSeconds()+e.getMinutes()+e.getHours()+e.getDay()},e.prototype.eventArgsChatWindow=function(e,t,i){return{visible:e,byUser:t,originalEvent:i}},e.prototype.isMobileDevice=function(){var e,t=!1;e=navigator.userAgent||navigator.vendor,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0);t&&/iPad/i.test(navigator.userAgent);return t},e.prototype.eventArgsQueueChange=function(e){return{queue:e}},e.prototype.getVariableValue=function(e){var t=null,i=this.profile;if(null==i||null==i.variables||i.variables.length<1)return null;for(var n=0;n<i.variables.length;n++){var s=i.variables[n];s.id==e&&(t=s.value)}return t},e.prototype.eventArgsSurveyRendered=function(e){return{survey:e}},e.prototype.restartSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.session.id=o.Utility.emptyGuid,this.setSessionId(o.Utility.emptyGuid),this.setSessionCache(),[4,this.getSession()];case 1:return e.sent(),this.triggerEvent(new o.Models.BeaconMsg(o.Utility.eventOnSessionRestart,this.session)),[2]}})})},e.prototype.eventArgsChatState=function(e,t,i){return{oldStatus:e,newStatus:t,chatId:i}},e.prototype.getRootUrl=function(e){return e.replace(/^(.*\/\/[^\/?#]*).*$/,"$1")},e.prototype.wireUpEvents=function(){var s=this;window.addEventListener("message",function(e){var t=e.data;if(t.originHash!=o.Models.BeaconMsg.currentOriginHash()&&t.event)switch(t.event){case o.Utility.eventInviteData:t.args.accepted&&s.triggerEvent(t);break;case"raw":document.body.insertAdjacentHTML("beforeend",t.args);break;case o.Utility.eventAlterCss:var i="["+o.Utility.attrRoleChat+"]";t.args.target&&(i=t.args.target);var n=s.bQueryAll(i);t.args.add?n.addClass(t.args.css):n.removeClass(t.args.css);break;default:s.triggerEvent(t)}}),document.addEventListener("mousedown",function(e){var t=e.target,i=t.isChildOfAttr(o.Utility.attrAction);if(t.hasAttribute(o.Utility.attrAction)||i){if(i)for(;t.parentElement;){if(t.parentElement.hasAttribute(o.Utility.attrAction)){t=t.parentElement;break}t=t.parentElement}t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement||s.processActions(t,e)}}),this.sessionRestarted.on(function(e){s.session=e.args,s.setSessionId(s.session.id),s.setVisitorId(s.session.visitor.id),s.setSessionCache()}),this.gdprUpdated.on(function(e){s.setGdpr(e.args.accepted)})},e.prototype.processActions=function(e,t){var i=e.getAttribute(o.Utility.attrAction),n=new Array;i&&(n=i.split(" "));for(var s=0;s<n.length;s++){switch(n[s]){case"minimize":var a=new o.Models.BeaconMsg(o.Utility.eventShowChatWindow,this.eventArgsChatWindow(!1,!0,t));this.triggerEvent(a);break;case"submitSurvey":a=new o.Models.BeaconMsg(o.Utility.eventOnSubmitSurvey);this.triggerEvent(a);break;case"endRequest":a=new o.Models.BeaconMsg(o.Utility.eventOnEndRequest);this.triggerEvent(a);break;case"endChat":a=new o.Models.BeaconMsg(o.Utility.eventOnEndChat);this.triggerEvent(a);break;case"print":a=new o.Models.BeaconMsg(o.Utility.eventOnPrintChat);this.triggerEvent(a);break;case"email":a=new o.Models.BeaconMsg(o.Utility.eventOnEmailChat);this.triggerEvent(a);break;case"sendSegment":a=new o.Models.BeaconMsg(o.Utility.eventOnSendSegment,t);this.triggerEvent(a);break;case"openWnd":a=new o.Models.BeaconMsg(o.Utility.eventOnOpenWnd,t);this.triggerEvent(a);break;case"maximize":a=new o.Models.BeaconMsg(o.Utility.eventShowChatWindow,this.eventArgsChatWindow(!0,!0,t));this.onWindowStateChange.trigger(a)}}},e.prototype.getAdditionalParmeters=function(e,t){var i={skipprechat:!1,skippostchat:!1,theme:this.queryStringPairs.theme,type:e,origin:null,visitorid:this.session.visitor.id,sessionid:this.session.id,c:0};return t&&(i.theme=t),i.skipprechat=this.queryStringPairs.skipprechat,i.skippostchat=this.queryStringPairs.skippostchat,i.origin=document.location.origin,i},e.prototype.triggerEvent=function(e){switch(e.event){case o.Utility.eventShowChatWindow:this.onWindowStateChange.trigger(e);break;case o.Utility.eventChatStateChanged:this.onChatStateChange.trigger(e);break;case o.Utility.eventQueueChanged:this.onQueueStateChange.trigger(e);break;case o.Utility.eventSurveyRendered:this.onSurveyRendered.trigger(e);break;case o.Utility.eventSurveyItemMissing:this.onSurveyItemMissing.trigger(e);break;case o.Utility.eventOnSubmitSurvey:this.onSubmitSurveyRequest.trigger(e);break;case o.Utility.eventOnEndRequest:this.onEndRequestRequest.trigger(e);break;case o.Utility.eventOnEndChat:this.onEndChatRequest.trigger(e);break;case o.Utility.eventOnPrintChat:this.onPrintChatRequest.trigger(e);break;case o.Utility.eventOnEmailChat:this.onEmailChatRequest.trigger(e);break;case o.Utility.eventOnSendSegment:this.onSendSegmentRequest.trigger(e);break;case o.Utility.eventOnOpenWnd:this.onOpenChatWnd.trigger(e);break;case o.Utility.eventSessionBanned:this.onSessionBanned.trigger(e);break;case o.Utility.eventAlterCss:this.onAlterCssRequest.trigger(e);break;case o.Utility.eventOnModuleInit:this.onModuleInit.trigger(e);break;case o.Utility.eventChatPolled:this.onChatPolled.trigger(e);break;case o.Utility.eventFileUploadProgressed:this.onFileUploadProgress.trigger(e);break;case o.Utility.eventSegmentSent:this.onSegmentSent.trigger(e);break;case o.Utility.eventSurveySubmitted:this.onSurveySubmitted.trigger(e);break;case o.Utility.eventSegmentsProcessed:this.onSegmentsProcessed.trigger(e);break;case o.Utility.eventSegmentRendered:this.onSegmentRendered.trigger(e);break;case o.Utility.eventInviteData:this.onInviteChange.trigger(e);break;case o.Utility.eventOnParentResize:this.onParentResize.trigger(e);break;case o.Utility.eventOnSessionRestart:this._onSessionRestart.trigger(e);break;case o.Utility.eventOnGdprUpdate:this._onGdprUpdate.trigger(e);break;case o.Utility.eventOnOpTypingChange:this._operatorTypingChanged.trigger(e);break;case o.Utility.eventOnFileEnableChange:this._fileEnabledChanged.trigger(e);break;case o.Utility.eventOnInputFocus:this._inputFocused.trigger(e)}},e.prototype.restoreCache=function(){var e=localStorage.getItem(o.Utility.storageKey),t=sessionStorage.getItem(o.Utility.storageKey);if(e)try{this._cache=JSON.parse(atob(e))}catch(e){}if(null==this._cache)if(this._cache={gdpr:{},visitor:new o.ServerModels.Account.Visitor.Visitor},this.queryStringPairs.siteid&&(this._cache.gdpr[this.queryStringPairs.siteid]=!1),e)this._cache.visitor.id=e;else{var i=null;(i=localStorage.getItem(o.Utility.VISITORID_CONST))&&localStorage.removeItem(o.Utility.VISITORID_CONST),null==i&&(i=o.Utility.emptyGuid),this._cache.visitor.id=i}if(t)try{this._sessionCache=JSON.parse(atob(t))}catch(e){}null==this._sessionCache&&(this._sessionCache={session:new o.ServerModels.Account.Site.Session.Session},this._sessionCache.session.id=t||o.Utility.emptyGuid)},e.prototype.setCache=function(){var e=JSON.stringify(this._cache);try{var t=btoa(e);localStorage.setItem(o.Utility.storageKey,t),e=JSON.stringify(this._sessionCache),t=btoa(e),sessionStorage.setItem(o.Utility.storageKey,t)}catch(e){console.log(this._cache),console.log(e)}},e.prototype.gdprAccepted=function(){return this._cache.gdpr[this.session.siteId]},e.prototype.setGdpr=function(e){this._cache.gdpr[this.session.siteId]=e,this.setCache()},e.prototype.getWndEvent=function(){return this._sessionCache.wndEvt},e.prototype.setWndEvent=function(e){this._sessionCache.wndEvt=e,this.setCache()},e.prototype.isBanned=function(){return this._cache.visitor.banned},e.prototype.setBan=function(e){this._cache.visitor.banned=e,this.setCache()},e}(),s.App=e}(ChatBeacon||(ChatBeacon={}));var beacon=new ChatBeacon.Application.App;(document.beacon=beacon).insertExternals();
//# sourceMappingURL=maps/chatbeacon.js.map
